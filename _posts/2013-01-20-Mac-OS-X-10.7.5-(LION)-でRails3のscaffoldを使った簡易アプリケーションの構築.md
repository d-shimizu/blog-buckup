---
layout: post
Categories:  ["tech"]
Description:  " はじめに  前回までで、Apacheと連携させたRuby on Rails環境の構築が完了しました。 今回は、開発環境の最終段階として、構築したRuby on Rails環境をBDと連携させて簡易なアプリケーションを動作させてみました。 "
Tags: ["Mac", "Rails", "MySQL", "環境構築"]
date: "2013-01-20T22:57:00+09:00"
title: "Mac OS X 10.7.5 (LION) でRails3のscaffoldを使った簡易アプリケーションの構築"
author: "dshimizu"
archive: ["2013"]
draft: "true"
---

<body>
<h4>はじめに</h4>
<p><a href="http://kanjuku-tomato.blogspot.jp/2013/01/mac-os-x-1075-lionruby-on-railsweb.html">前回</a>までで、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Apache">Apache</a>と連携させた<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby%20on%20Rails">Ruby on Rails</a>環境の構築が完了しました。<br>今回は、開発環境の最終段階として、構築した<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby%20on%20Rails">Ruby on Rails</a>環境をBDと連携させて簡易なアプリケーションを動作させてみました。 <br><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>で利用する標準DBは<a class="keyword" href="http://d.hatena.ne.jp/keyword/SQLite">SQLite</a>になってますが、他にも<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>や<a class="keyword" href="http://d.hatena.ne.jp/keyword/PostgreSQL">PostgreSQL</a>を使用することができます。<br>ここでは<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>を使った<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby%20on%20Rails">Ruby on Rails</a>環境の構築のため、<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>をインストールし、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>との接続を試してみましたのでここにまとめ、記載致します。 </p> <a name="more"></a>  <h5>事前準備(<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>の設定)</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーションで利用するデータベースを作成しておきます。 ここではscaffoldapp_developmentという名前のデータベースを作成します。 </p>
<pre class="terminal">  mysql&gt; mysql -u root -p mysql&gt; create database scaffoldapp_development default character set utf8; Query OK, 1 row affected (0.00 sec) mysql&gt; show databases; +---------------------+ | Database            | +---------------------+ | information_schema  | | mysql               | | performance_schema  | | test                | | scaffoldapp_development | +---------------------+ 5 rows in set (0.01 sec)  
</pre>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>からデータベースへ接続するためのユーザを作成します。 ここでは<a class="keyword" href="http://d.hatena.ne.jp/keyword/rails">rails</a>という名前のユーザを作成し、<a class="keyword" href="http://d.hatena.ne.jp/keyword/rails">rails</a>ユーザのパスワードを<a class="keyword" href="http://d.hatena.ne.jp/keyword/rails">rails</a>としています。<br></p>
<pre class="terminal">  mysql&gt; grant all on scaffoldapp_development.* to 'rails'@'localhost'; Query OK, 0 rows affected (0.01 sec) mysql&gt; set password for 'rails'@'localhost' = password('rails'); Query OK, 0 rows affected (0.00 sec)  </pre> <h5>scaffoldによる<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーションの作成</h5>
<p><a href="http://kanjuku-tomato.blogspot.jp/2013/01/mac-os-x-1075-lionruby-on-railsweb.html">前回</a>設定した<a class="keyword" href="http://d.hatena.ne.jp/keyword/Apache">Apache</a>のドキュメントルート(/Users/xxxxx(ユーザ名)/www/)へ移動し、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーションを作成します。-dオプション(データベース指定用のオプション)に<a class="keyword" href="http://d.hatena.ne.jp/keyword/mysql">mysql</a>を指定します。</p>
<pre class="terminal">  % cd /Users/xxxxx(ユーザ名)/www % rails new scaffoldapp -d mysql  </pre> <p>scaffoldapp フォルダへ移動し、以下のコマンドを実行します。 </p>
<pre class="terminal">  % cd /Users/xxxxx(ユーザ名)/www/scaffoldapp % rails g scaffold item name:string phone:string mail:string       invoke  active_record       create    db/migrate/20130120105422_create_items.rb       create    app/models/item.rb       invoke    test_unit       create      test/unit/item_test.rb       create      test/fixtures/items.yml       invoke  resource_route        route    resources :items       invoke  scaffold_controller       create    app/controllers/items_controller.rb       invoke    erb       create      app/views/items       create      app/views/items/index.html.erb       create      app/views/items/edit.html.erb       create      app/views/items/show.html.erb       create      app/views/items/new.html.erb       create      app/views/items/_form.html.erb       invoke    test_unit       create      test/functional/items_controller_test.rb       invoke    helper       create      app/helpers/items_helper.rb       invoke      test_unit       create        test/unit/helpers/items_helper_test.rb       invoke  assets       invoke    coffee       create      app/assets/javascripts/items.js.coffee       invoke    scss       create      app/assets/stylesheets/items.css.scss       invoke  scss       create    app/assets/stylesheets/scaffolds.css.scss  </pre> <p>ここで生成されるファイルは以下のようなものです。 </p>
<pre class="file">  testapp                             … アプリケーションのルートディレクトリ   - app                              … MVCに関わるアプリケーションの中心的なコード     - asset                          … 画像、CSS、JavaScript     - controllers                  … コントローラークラス    - items_controller.rb     … コントローラクラス     - helpers                       … ヘルパーモジュール（ビュー用のヘルパーメソッド）    - items_helper.rb          …  ビューヘルパー     - mailers                        … メール用のコントローラー     - models                        … モデルクラス    - items.rb                    … モデルクラス     - views                          … テンプレート類    - items       - edit.html.erb          … 編集画面    - index.html.erb        … 一覧画面    - new.html.erb          … 新規登録画面    - show.html.erb        … 詳細画面    - _from.html.erb       … 部分テンプレート   - config                           … 設定ファイル類     - environments              … 開発、テスト、本番運用といった環境ごとの設定     - initializers                    … アプリケーション起動時に実行したいファイル     - locales                        … 国際化に関するリソース   - db                                 … データベースに関するファイル     - migrate    - YYYYMMDDhhmmss_create_items.rb    … DBマイグレーションファイル   - doc                               … rdocなどのドキュメント   - lib                                 … アプリケーションが使うライブラリコード全般   - log                                … アプリケーションが出力するログ   - public                            … Webの静的なコンテンツ   - script                            … ユーティリティースクリプト   - test                               … Railsのデフォルトの自動テストに関するファイル      - fixtures        - items.yml                  … テストデータ用Fixtureファイル   - functional        - items_controller_test.rb    … ファンクショナルテスト用ファイル   - integration   - performance   - unit         - item_test.rb             … ユニットテスト用ファイル         - helper     - item_helper_test.rb    … ヘルパークラスのユニットファイル   - tmp                              … 一時ファイル   - vendor                          … アプリケーション外部に由来するコード  </pre> <p>database.<a class="keyword" href="http://d.hatena.ne.jp/keyword/xml">xml</a>ファイルに<a class="keyword" href="http://d.hatena.ne.jp/keyword/rails">rails</a>から接続するための<a class="keyword" href="http://d.hatena.ne.jp/keyword/mysql">mysql</a>のユーザ/パスワード、接続先データベース名を記載します。 </p>
<pre class="terminal">  % cd config % vim database.yml ### 修正 development:   adapter: mysql2   encoding: utf8   reconnect: false   database: scaffoldapp_development  MySQLの設定環境に合わせて記載   pool: 5   username: rails    MySQLの設定環境に合わせて記載   password: rails    MySQLの設定環境に合わせて記載   socket: /tmp/mysql.sock  </pre>  <p>Rake(<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のビルドツール)を用いてデータベースの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>を行います。<br>以下のコマンドを実行することで、<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>データベースに必要なテーブルを自動で作成できます。 </p>
<pre class="terminal">  % rake db:migrate ==  CreateItems: migrating ==================================================== -- create_table(:items)    -&gt; 0.0118s ==  CreateItems: migrated (0.0119s) ===========================================  </pre> <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>の状態を確認するには以下のように実行します。 </p>
<pre class="terminal">  % rake db:migrate:status (in /Users/shimizu/www/scaffoldapp)  database: testapp_development   Status   Migration ID    Migration Name --------------------------------------------------    up     20130120105422  Create items  </pre> <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>にログインしてテーブルが作成されていることを確認してみます。 </p>
<pre class="terminal">  % mysql -u root -p Enter password:  Welcome to the MySQL monitor.  Commands end with ; or \g. Your MySQL connection id is 14 Server version: 5.5.29 Source distribution  Copyright (c) 2000, 2012, Oracle and/or its affiliates. All rights reserved.  Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners.  Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.  mysql&gt;  mysql&gt; use scaffoldapp_development Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A  Database changed mysql&gt; mysql&gt; show tables; +-------------------------------+ | Tables_in_scaffoldapp_development | +-------------------------------+ | items                         | | schema_migrations             | +-------------------------------+ 2 rows in set (0.00 sec)  </pre>  <h4>動作確認</h4> <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/127.0.0.1">127.0.0.1</a>(<a class="keyword" href="http://d.hatena.ne.jp/keyword/localhost">localhost</a>)へのhttpアクセスで<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーションの画面が表示されるはずです。 </p>
<p><a href="http://127.0.0.1/scaffoldapp/public/items">http://127.0.0.1/scaffoldapp/public/items</a> </p>
<div class="separator" style="clear: both; text-align: left;"><a href="http://4.bp.blogspot.com/-yn9jFMjzYtM/UQUoDGzsTkI/AAAAAAAAAP0/Gu99Xzcr9SE/s1600/rails_app_01.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="231" width="373" src="http://4.bp.blogspot.com/-yn9jFMjzYtM/UQUoDGzsTkI/AAAAAAAAAP0/Gu99Xzcr9SE/s400/rails_app_01.png"></a></div>少し操作してみます。テキストボックスに適当に入力して"Create Item"を押下します。 <div class="separator" style="clear: both; text-align: left;"><a href="http://4.bp.blogspot.com/-5eNaVzWjqI8/UQUrlxfBYDI/AAAAAAAAAQI/k0A4GCCIQ04/s1600/rails_app_02.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="278" width="350" src="http://4.bp.blogspot.com/-5eNaVzWjqI8/UQUrlxfBYDI/AAAAAAAAAQI/k0A4GCCIQ04/s400/rails_app_02.png"></a></div>以下のように表示されます。 <div class="separator" style="clear: both; text-align: left;"><a href="http://1.bp.blogspot.com/-2wLnUobcniM/UQUuUbeMbwI/AAAAAAAAAQ0/GpG8l-BPsrA/s1600/rails_app_03.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="199" width="299" src="http://1.bp.blogspot.com/-2wLnUobcniM/UQUuUbeMbwI/AAAAAAAAAQ0/GpG8l-BPsrA/s400/rails_app_03.png"></a></div> <h4>おわりに</h4>
<p>以上で、<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>を使った<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーションの環境が構築できました。 </p>
<h4>参考</h4>
<p>今回の作業にあたり、以下の記事を参考にさせていただきました。 </p>
<ul>  <li>
<a href="http://gihyo.jp/dev/serial/01/vps_ruby/0004">VPSでRuby開発をしよう：第4回　Railsでの開発は本当に簡単か?</a> </li>  <li><a href="http://www.atmarkit.co.jp/fcoding/rails/articles/rails3/01/rails301c.html">Ruby on Rails3で学ぶ、Web開発のキホン － ＠IT</a></li>  <li><a href="http://saifis.net/?p=167">Redmine(Rails)をApacheと連携させたい　Phusion Passenger導入</a></li>  <li><a href="http://www.happytrap.jp/blogs/2012/01/21/6931/">Mac OS X LionでApache、PHP、MySQLを動かす | HAPPY*TRAP</a></li>  <li><a href="http://www.techscore.com/tech/Ruby/Rails/quick-start/Rails4/4-1">4. scaffoldを利用した開発(1)</a></li>
</ul>
</body>

<!-- more -->


