---
layout: post
Categories:  ["tech"]
Description:  " はじめに  MyNA会(日本MySQLユーザ会) 2013年3月 へ参加してきました。      MyNA News : MyNA(日本MySQLユーザ会)会 2013年3月 のお知らせ    MyNA(日本MySQLユーザ会)会 201"
Tags: ["MySQL", "勉強会"]
date: "2013-03-21T01:55:00+09:00"
title: "MyNA会(日本MySQLユーザ会) 2013年3月 へ参加してきました"
author: "dshimizu"
archive: ["2013"]
draft: "true"
---

<body>
<h4>はじめに</h4>
<p>MyNA会(日本<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>ユーザ会) 2013年3月 へ参加してきました。 </p>
<ul>  <li><a href="http://www.mysql.gr.jp/frame/modules/news/article.php?storyid=222">MyNA News : MyNA(日本MySQLユーザ会)会 2013年3月 のお知らせ</a></li>  <li><a href="http://atnd.org/events/37387">MyNA(日本MySQLユーザ会)会 2013年3月 : ATND</a></li>
</ul>
<a name="more"></a><p>私はDBエンジニアというわけではありませんが、最近<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>データベースをさわりはじめたので、いきなりはハードルが高いかと思いながらも少しでも勉強になればと思い参加させていただきました。<br>以下は、復習を兼ねた自分なりのメモや追加でほんの少し調べてみたことなどのまとめです。 </p> <h4>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BB%A5%DF">セミ</a>ナー概要</h4>上記リンク先に記載されていますが、当日の内容は以下の通りでした。 <h5>セッション</h5>
<table> <tr>  <th>発表者</th>  <th>タイトル</th> </tr> <tr>  <td>平塚様(@sh2nd)</td>  <td>チューニンガソン5の復習 <a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a> 5.6 新機能編</td> </tr> <tr>  <td>yoku様(@yoku0825)</td>  <td>意外と話題に上がらない、mysqld以外の5.6新機能</td> </tr> <tr>  <td>奥野様(@nippondanji)</td>  <td>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a> 5.6 新機能(熱)</td> </tr>
</table>
<h5>ライトニング<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C8%A1%BC%A5%AF">トーク</a>
</h5>
<table> <tr>  <th>発表者</th>  <th>タイトル</th> </tr> <tr>  <td>木村様(@meijik)</td>  <td>performance_schemaとinformation_schemaを5分で語る</td> </tr> <tr>  <td>梶山様(@RKajiyama)</td>  <td>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a> Connect 2013</td> </tr> <tr>  <td>木下様</td>  <td>特別登壇</td> </tr>
</table> <h4>講演</h4> <h5>平塚様：チューニンガソン5の復習 <a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a> 5.6 新機能編</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/Oracle">Oracle</a> Aceとなられた平塚様のお話。<br>チューニンガソン5の内容について振り返り後、チューニンガソンで登場した6種類のクエリに対して、MySQL5.6でのチューニング手法、ノウハウを御紹介いただきました。  資料が公開されていますのでそれを見ていただくのが良いのは間違いないですが、自身のメモ/復習のために以下に内容をまとめておきます。 </p>
<h6>チューニング内容</h6>
<ul>  <li>MySQL5.6へのアップデート</li>  <li>インデックスの追加</li>  <ul>    <li>Optimizer Traceの利用</li>  </ul>  <li>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AA%A5%D7%A5%C6%A5%A3%A5%DE">オプティマ</a>イザの精度向上</li>  <li>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D2%A5%E5%A1%BC%A5%EA%A5%B9%A5%C6%A5%A3%A5%C3%A5%AF">ヒューリスティック</a>の排除</li>  <li>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AA%A5%D7%A5%C6%A5%A3%A5%DE">オプティマ</a>イザ・ヒントの付与</li>  <li>サブクエリのマテ<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EA%A5%A2%A5%E9">リアラ</a>イゼーション</li>  <li>テーブルの非正規化</li>
</ul>
<h6>MySQL5.6へのアップデート</h6>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a> 5.6ではパフォーマンス<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AD%A1%BC%A5%DE">スキーマ</a>がデフォルトで有効になっていることや<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BF%A5%C7%A1%BC%A5%BF">メタデータ</a>ロックの仕組みにCPUスケーラビリティがないことが原因で、<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a> 5.5より性能面が低下しているとのことでした。<br></p>
<h6>インデックスの追加 - Optimizer Traceの利用</h6>
<p>チューニングとしては、Covering Indexなどインデックスの張り方の見直しを実施されてましたが、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AA%A5%D7%A5%C6%A5%A3%A5%DE">オプティマ</a>イザの判断によってはIndexを利用されないケースもあるようです。そういった際には<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a> 5.6の新機能であるOptimizer Traceという機能で<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AA%A5%D7%A5%C6%A5%A3%A5%DE">オプティマ</a>イザの内部動作を確認できるそうです。<br>ただ、Optimizer Traceは<a class="keyword" href="http://d.hatena.ne.jp/keyword/JSON">JSON</a>形式で数百行も出力される上にマニュアルがないので、読むのは慣れ… </p>
<h6>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AA%A5%D7%A5%C6%A5%A3%A5%DE">オプティマ</a>イザの精度向上(レンジ分析範囲の修正)/<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D2%A5%E5%A1%BC%A5%EA%A5%B9%A5%C6%A5%A3%A5%AF%A5%B9">ヒューリスティクス</a>の排除</h6>
<p>上述の、"<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AA%A5%D7%A5%C6%A5%A3%A5%DE">オプティマ</a>イザがインデックスを利用しない実行計画を選ぶ"といったような良くない判断をする原因として、<a class="keyword" href="http://d.hatena.ne.jp/keyword/InnoDB">InnoDB</a>での"インデックスに保存されているレコードの読み取り数の見積もり方が良くない"とのこと。<a class="keyword" href="http://d.hatena.ne.jp/keyword/InnoDB">InnoDB</a>は読み取るレコード数をコスト計算に利用し、インデックス内の読み取りレコード数を11ページのリーフページで見積もる動作であり、今回のように大量のデータに対するクエリでは、読み取りレコード数の見積もりが正確ではなかったため、インデックスを利用した場合のコストが大きいと<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AA%A5%D7%A5%C6%A5%A3%A5%DE">オプティマ</a>イザが判断したようです。<br>平塚様がちょっとだけ本気を出されて<a class="keyword" href="http://d.hatena.ne.jp/keyword/InnoDB">InnoDB</a>のソースから、<a class="keyword" href="http://d.hatena.ne.jp/keyword/InnoDB">InnoDB</a>のレンジ分析の精度をあげるためにアクセスするリーフページ数の割合を本来の10倍に変更したり、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D2%A5%E5%A1%BC%A5%EA%A5%B9%A5%C6%A5%A3%A5%C3%A5%AF">ヒューリスティック</a>な<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A2%A5%EB%A5%B4%A5%EA%A5%BA%A5%E0">アルゴリズム</a>を除去する修正をされていました。 </p>
<h6>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AA%A5%D7%A5%C6%A5%A3%A5%DE">オプティマ</a>イザ・ヒントの付与</h6>
<p>STRAIGHT_JOINを使ってJOINの順序を強制し、Force Indexを使って利用するインデックスを強制することで、クエリにLoose Index Scanという手法を用いるようにしていました。 </p>
<h6>サブクエリのマテ<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EA%A5%A2%A5%E9">リアラ</a>イゼーション</h6>
<p>サブクエリに対して中間テーブルを用いることで、クエリを高速化する手法を用いられていますが、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D0%A5%C3%A5%C9%A5%CE%A5%A6%A5%CF%A5%A6">バッドノウハウ</a>とのこと。 マテ<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EA%A5%A2%A5%E9">リアラ</a>イゼーションは、tmp_table_sizeの値までのデータであればMEMORYストレージエンジンが用いられるそうですが、tmp_table_sizeの値を越えるデータ量になると、<a class="keyword" href="http://d.hatena.ne.jp/keyword/MyISAM">MyISAM</a>ストレージエンジン(つまりディスク上)に切り替わるようです。tmp_table_sizeで収まる場合はメモリ内でデータが処理できるので効果があるとのこと。 </p>
<h6>テーブルの非正規化</h6>
<p>大量のレコードを処理するクエリに対しては、テーブルの非正規化を行うことで高い効果を得られるそうです。 </p> <h5>yoku様：意外と話題に上がらない、mysqld以外の5.6新機能</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/mysql">mysql</a>_install_db, <a class="keyword" href="http://d.hatena.ne.jp/keyword/mysql">mysql</a>_config_editor, mysqlbinlogを中心とした<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>付属ツールの御紹介。 この辺りのツールやユーティリティはまだきちんと使ったことがないものばかりだったので今後調べて使ってみようと思ってます。 </p>
<h6><a href="http://dev.mysql.com/doc/refman/5.6/en/mysql-install-db-problems.html">mysql_install_db</a></h6>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>を初期化するプログラム。<a class="keyword" href="http://d.hatena.ne.jp/keyword/rpm">rpm</a>インストール時には最後に自動で実行されます。 MySQL5.6では--random-passwordsオプションにより初期ランダムパスワードが設定されるようになっていたり、パスワードの有効期限(password_expired)設定が有効になっていたりとセキュリティ面を考慮したような変更点があるそうです。 あと、my.cnfの作成先が/etc/my.cnfから$<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>_DATA(<a class="keyword" href="http://d.hatena.ne.jp/keyword/RPM">RPM</a>インストール時の標準は/usr/share/<a class="keyword" href="http://d.hatena.ne.jp/keyword/mysql">mysql</a>)/my.cnfに変わったようです。 </p> <h6><a href="http://dev.mysql.com/doc/refman/5.6/en/mysql-config-editor.html">mysql_config_editor</a></h6>
<p>これもセキュリティ面の改善となるのでしょうか。<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a> 5.6から<a class="keyword" href="http://d.hatena.ne.jp/keyword/mysql">mysql</a>_config_editorというコマンドを使用して、.mylogin.cnfというファイルにパスワードを暗号化して保存できるようになったとのこと。 </p> <h6><a href="http://dev.mysql.com/doc/refman/5.6/en/mysqlbinlog.html">mysqlbinlog</a></h6>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>サーバが生成するバイナリログをテキスト形式で確認するツール。<br>--read-from-remote-master, --stop-never, --row, --result-file といった様々なオプションが登場しましたが、mysqlbinlog自体を使ったことも無い身としては追いきれませんでしたので、別途調べていきたいと思います。 </p> <h5>奥野様：<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a> 5.6 新機能(熱)</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D7%A5%ED%A5%D7%A5%E9%A5%A4%A5%A8%A5%BF%A5%EA">プロプライエタリ</a>なディスプレイドライバがうまく動作しなかったようで、プロジェクタに映像が出ないというトラブルがあり、木村様のPCを借りられてのスタートだった模様。 <a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>の歴史についてのお話から始まり、「5.6の新機能紹介」のデモ…の予定でしたが、上述のトラブルにより事前に御準備いただいていたデモ環境が利用できない状態だったため、その場で<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a> SandBoxという複数の<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>環境を手軽に構築できるツールを利用しての環境作成から行われていました。 </p>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a> SandBoxのことは知りませんでしたが、<a class="keyword" href="http://d.hatena.ne.jp/keyword/CPAN">CPAN</a>経由でのインストールが容易にインストールできるようです。 利用したい<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>を取得し、シェルの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B4%C4%B6%AD%CA%D1%BF%F4">環境変数</a>を一つ設定して、make_sandboxコマンドで<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>のビルドを行えば<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a> SandBoxでの<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>インストールが可能なようで、ポートは<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>のバージョンに応じて自動で決定されるようなので、容易に複数のバージョンをインストールして試すといったことができるようです。 </p>
<p>時間の都合もあり、予定していたデモを全て実施いただけなかったため、当日実施予定だったデモの内容は改めて<a class="keyword" href="http://d.hatena.ne.jp/keyword/Youtube">Youtube</a>に公開いただけるそうです。楽しみです。<br>また、MySQL5.6の新機能については昨年のdb tech showcase 2012の資料が奥野様の<a class="keyword" href="http://d.hatena.ne.jp/keyword/SlideShare">SlideShare</a>へ公開されておりました。 </p>
<ul>  <li>
<a href="http://www.slideshare.net/nippondanji/mysql-56dbtechshowcase2012">MySQL 5.6新機能解説@dbtechshowcase2012 by @nippondanji on @slideshare</a>  </li>
<li><a href="http://mysqlsandbox.net/">Mysql Sandbox</a></li>
</ul> <h4>LT(ライトニング<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C8%A1%BC%A5%AF">トーク</a>)</h4> <h5>木村様：performance_schemaとinformation_schemaを5分で語る</h5>
<p>ps_helperというものを用いたperformance_schema(統計情報)の解析についてのお話。 まだ使い方はよく分かりませんが、以下のリンクを見ると図が作成できたりと面白そうでした。 </p>
<ul>  <li><a href="http://www.markleith.co.uk/ps_helper/">ps_helper | Mark Leith</a></li>  <li><a href="http://www.markleith.co.uk/ps_helper/ps_helper-dump_thread_stack/">dump_thread_stack() - ps_helper | Mark Leith</a></li>
</ul>  <p>執筆された下記書籍をじゃんけん大会の商品として提供していただき、見事に勝ち残られた方は和歌山からいらっしゃった方でした。 </p>
<ul>  <li><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4774150266/unofficiadb2b-22/ref=nosim/">プロになるための データベース技術入門　~MySQLforWindows困ったときに役立つ開発・運用ガイド [大型本]</a></li>
</ul> <h5>梶山様：<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a> Connect 2013</h5>
<p>今秋(9月)にサンフランシスコで開催される<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a> Connect 2013についてのお話。当日の講演者を募集されているそうです。 参加するには敷居が高い… </p>
<ul>  <li><a href="http://www.oracle.com/mysqlconnect/index.html">MySQL Connect</a></li>
</ul>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>のnode.js <a class="keyword" href="http://d.hatena.ne.jp/keyword/API">API</a>などについてもちらほら… </p>
<ul>  <li><a href="http://dev.mysql.com/tech-resources/articles/cluster-7.3-dmr.html">New MySQL Cluster 7.3 Previews: Foreign Keys, NoSQL Node.js API and Auto-Tuned Clusters</a></li>
</ul> <h5>木下様：特別登壇</h5>
<p>前述のトラブルの影響もあって、<a class="keyword" href="http://d.hatena.ne.jp/keyword/InnoDB">InnoDB</a>の開発者である木下様の登壇のお時間がありました。 </p>
<ul>  <li><a href="http://enterprisezine.jp/dbonline/detail/4322">InnoDBのプロは寡黙な紳士―木下靖文さん : EnterpriseZine</a></li>
</ul>
<p>最初のセッションでの平塚様の<a class="keyword" href="http://d.hatena.ne.jp/keyword/InnoDB">InnoDB</a>に関する指摘のあとでの登壇でしたが、むしろ今後の<a class="keyword" href="http://d.hatena.ne.jp/keyword/InnoDB">InnoDB</a>の伸びしろを感じてほしいとのこと！<br>MySQL5.6がリリースされて、MySQL5.7にも取り組んでいるそうですが、公式アナウンスが無い現状では話せることがないそうです。<br></p>
<p>司会の坂井様とのやり取り(漫談？)も面白かったです。 </p> <h4>おわりに</h4>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>に限った話ではないと思いますが、こういった<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BB%A5%DF">セミ</a>ナーでいろいろなお話を聞くと、やはりそのソフトウェアなりアプリケーションなりの仕組みを理解するというのは重要だということを思います。<br><a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>だと、<a class="keyword" href="http://d.hatena.ne.jp/keyword/SQL">SQL</a>がどのように動作するか、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AA%A5%D7%A5%C6%A5%A3%A5%DE">オプティマ</a>イザがどういう判断をするか、ストレージエンジンがどういう仕組みになっているか、どういう機能があってどういうことが出来るのか等々。使い込まないと見えてこない部分もたくさんあると思うので、理解を深めるためには積極的にいろいろ使っていければと思います。 <a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>が参照可能なので、そのレベルで理解して対応できれば最高なんでしょうけど、<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>初心者の私にとっては凄いテクニックも様々な有効な機能もまだ理解しきれない部分が多々あったので、とりあえず聞いたことを噛み砕いて整理している段階ですが… </p>
<p>最後になりましたが、スタッフの皆様、スピーカー/登壇者の皆様、貴重なお話を誠にありがとうございました。 </p>
<h4>参考</h4>
<p>公開いただいている当日の発表資料をしっかり読み返したいと思います。 </p>
<h6>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BB%A5%DF">セミ</a>ナー資料</h6>
<ul>  <li>坂井様：<a href="http://d.hatena.ne.jp/sakaik/20130315/mysql_kaikai_201303">日本MySQLユーザ会会2013.03開催しました - sakaikの日々雑感～(T)編</a>
</li>  <li>平塚様：<a href="http://d.hatena.ne.jp/sh2/20130318">チューニンガソン5の復習 MySQL 5.6 新機能編 - SH2の日記</a>
</li>  <ul>    <li><a href="http://dbstudy.info/files/20130318/tuningathon5_mysql56.pdf">チューニンガソン5の復習 MySQL 5.6 新機能編 - PDF資料</a></li>  </ul>  <li>yoku様：<a href="http://yoku0825.blogspot.com/2013/03/myna-201303.html">日々の覚書: MyNA 2013/03 行ってきました</a>
</li>  <ul>    <li><a href="http://www.slideshare.net/yoku0825/mysql-clients">MySQL Clients!at MySQL Nippon Association</a></li>  </ul>
</ul> <h6>Togetter</h6>
<ul>  <li><a href="http://togetter.com/li/473582">MyNA会2013年3月 - Togetter</a></li>
</ul>
</body>

<!-- more -->


