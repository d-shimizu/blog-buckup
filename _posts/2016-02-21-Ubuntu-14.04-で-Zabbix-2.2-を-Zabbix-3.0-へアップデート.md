---
layout: post
Categories:  ["tech"]
Description:  " はじめに  2016/2/16 Zabbix 3.0.0 がリリースされました。       Zabbix 3.0.0リリースノート      Zabbix 3.0.0リリース | ZABBIX-JP   現在使っているUbuntu標準パ"
Tags: ["tech", "Ubuntu", "Zabbix"]
date: "2016-02-21T20:47:00+09:00"
title: "Ubuntu 14.04 で Zabbix 2.2 を Zabbix 3.0 へアップデート"
author: "dshimizu"
archive: ["2016"]
draft: "true"
---

<body>
<h3>はじめに</h3>


<p>2016/2/16 Zabbix 3.0.0 がリリースされました。</p>

<ul>
    <li><a href="http://www.zabbix.com/jp/rn3.0.0.php" target="_blank" rel="noopener noreferrer">Zabbix 3.0.0リリースノート</a></li>
    <li><a href="http://www.zabbix.jp/node/3455" target="_blank" rel="noopener noreferrer">Zabbix 3.0.0リリース | ZABBIX-JP</a></li>
</ul>


<p>現在使っている<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ubuntu">Ubuntu</a>標準パッケージでインストールしていたZabbix 2.2.2をZabbix公式<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EA%A5%DD%A5%B8%A5%C8%A5%EA">リポジトリ</a>から3.0.0パッケージを取得してアップデートしようと思います。</p>
</body>

<!-- more -->

<body>
<h3>Zabbixのアップデート</h3>


<h4>バックアップ</h4>


<p>2.2系から3.0へのメジャーバージョンアップになるので、念のため既存のZabbix 2.2.2の設定ファィルとデータベースのデータのバックアップを取得します。</p>

<ul>
    <li>Zabbixサーバ設定ファイル</li>
    <li>Zabbix用データベース</li>
</ul>


<h5>Zabbixサーバの設定ファイルのバックアップ</h5>


<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/deb">deb</a>パッケージでインストールしているので以下にある設定ファイルをコピーします。</p>

<pre class="terminal"> # cp -pr /etc/zabbix /etc/zabbix222
 </pre>


<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/PHP">PHP</a>のファイルなどなどもバックアップしておいたほうが良いのでしょうけどここでは実施しませんでした。</p>

<h5>Zabbix用データベースのバックアップ</h5>


<p>データベースには<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>を使っているので、mysqldumpを使ってzabbixのデータベースのバックアップを取得します。</p>

<pre class="terminal"> # mysqldump --single-transaction -u zabbix -p &gt; /tmp/zabbix2.2_`date +%Y%m%d`.dump
 </pre>


<h4>Zabbix 2.2停止</h4>


<p>念のためZabbixサーバ、Zabbixエージェントを停止します。</p>

<pre class="terminal"> # service zabbix-server stop
 </pre>


<pre class="terminal"> # service zabbix-agent stop
 </pre>


<h4>Zabbix 3.0.0のインストール</h4>


<p>Zabbixサーバ、フロントエンド、エージェントの<a class="keyword" href="http://d.hatena.ne.jp/keyword/deb">deb</a>パッケージを取得します。</p>

<pre class="terminal"> # wget http://repo.zabbix.com/zabbix/3.0/ubuntu/pool/main/z/zabbix/zabbix-server-mysql_3.0.0-1+trusty_amd64.deb
# wget http://repo.zabbix.com/zabbix/3.0/ubuntu/pool/main/z/zabbix/zabbix-frontend-php_3.0.0-1+trusty_all.deb
# wget http://repo.zabbix.com/zabbix/3.0/ubuntu/pool/main/z/zabbix/zabbix-agent_3.0.0-1+trusty_amd64.deb
 </pre>


<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/deb">deb</a>パッケージをインストールします。</p>

<pre class="terminal"> # dpkg -i zabbix-server-mysql_3.0.0-1+trusty_amd64.deb zabbix-frontend-php_3.0.0-1+trusty_all.deb zabbix-agent_3.0.0-1+trusty_amd64.deb
 </pre>


<h4>Zabbix 3.0.0の設定ファイル編集</h4>


<p>Zabbixサーバ、Zabbixエージェントの2.2.2と3.0.0の設定ファイルの差分を確認し、必要な設定があれば3.0.0の設定ファイルへ追記します。</p>

<pre class="terminal"> # diff -u /etc/zabbix222/zabbix_server.conf /etc/zabbix/zabbix_server.conf
 </pre>


<pre class="terminal"> # diff -u /etc/zabbix222/zabbix_agentd.conf /etc/zabbix/zabbix_agentd.conf
 </pre>


<p>設定ファイル修正後、Zabbix Server, Zabbix Agentを起動します。</p>

<pre class="terminal"> # service zabbix-server start
 </pre>


<pre class="terminal"> # service zabbix-agentd start
 </pre>


<p>※Zabbix Agent起動時、<code>/etc/zabbix/zabbix_agentd.conf.d</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リが存在しないと起動しませんが、エラーが出ません。もし起動しない場合はこの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リの有無を確認してみて下さい。</p>

<h4>Zabbix 3.0.0のセットアップ</h4>


<p>ブラウザからZabbixのWeb管理画面へアクセスします。</p>

<p><a href="http://Zabbix">http://Zabbix</a>サーバの<a class="keyword" href="http://d.hatena.ne.jp/keyword/IP%A5%A2%A5%C9%A5%EC%A5%B9">IPアドレス</a>/zabbix</p>

<p>Next Step をクリックして次へ進みます。
<img src="../wp-content/uploads/2016/02/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88-2016-02-19-23.02.00.png"></p>

<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/PHP">PHP</a> のパラメータやモジュールに問題ないか確認します。
特に2.2.2の設定から変更すべき点はありませんでしたが、NGの部分があれば変更します。
NGが全て消えたらNext Stepをクリックして次へ進みます。
<img src="../wp-content/uploads/2016/02/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88-2016-02-19-23.02.18.png"></p>

<p>DB接続情報を入力します。
入力したらNext Stepをクリックしてつぎへ　進みます。
<img src="../wp-content/uploads/2016/02/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88-2016-02-19-23.10.55.png"></p>

<p>Zabbixサーバの設定情報を入力します。
入力したらNext Stepをクリックしてつぎへ　進みます。
<img src="../wp-content/uploads/2016/02/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88-2016-02-19-23.11.34.png"></p>

<p>設定値を確認します。
問題なければしたらNext Stepをクリックして次へ進みます。
<img src="../wp-content/uploads/2016/02/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88-2016-02-19-23.11.54.png"></p>

<p>インストール完了です。
Finishをクリックしてログイン画面へ進みます。
<img src="../wp-content/uploads/2016/02/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88-2016-02-19-23.12.13.png"></p>

<h3>おわりに</h3>


<p>以上でZabbix 3.0.0へのアップデートが完了です。</p>
</body>
