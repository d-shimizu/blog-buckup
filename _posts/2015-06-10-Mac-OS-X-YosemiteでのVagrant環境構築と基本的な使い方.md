---
layout: post
Categories:  ["tech"]
Description:  " はじめに  Vagrantとは、仮想マシンの作成や環境構築、仮想マシンの破棄までを自動化するツールです。Vagrant用の構成情報を記述した設定ファイルを用意して、vagrant用の様々なコマンドを実行するだけで仮想ディスクイメージのダウ"
Tags: ["Vagrant", "OS X"]
date: "2015-06-10T23:59:00+09:00"
title: "Mac OS X YosemiteでのVagrant環境構築と基本的な使い方"
author: "dshimizu"
archive: ["2015"]
draft: "true"
---

<body>
<h4>はじめに</h4>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>とは、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B2%BE%C1%DB%A5%DE%A5%B7%A5%F3">仮想マシン</a>の作成や環境構築、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B2%BE%C1%DB%A5%DE%A5%B7%A5%F3">仮想マシン</a>の破棄までを自動化するツールです。<a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>用の構成情報を記述した設定ファイルを用意して、<code>vagrant</code>用の様々なコマンドを実行するだけで仮想ディスクイメージのダウンロードや<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B2%BE%C1%DB%A5%DE%A5%B7%A5%F3">仮想マシン</a>の作成および起動、停止、<a class="keyword" href="http://d.hatena.ne.jp/keyword/ssh">ssh</a>接続等が実行できます。 </p>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>を利用することで、同一構成の複数の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B2%BE%C1%DB%A5%DE%A5%B7%A5%F3">仮想マシン</a>を簡単に作成できます。テスト用の仮想環境が必要な場合に利用されることが多いようです。 作成した<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B2%BE%C1%DB%A5%DE%A5%B7%A5%F3">仮想マシン</a>はコマンドで簡単に破棄できるため、実運用環境を<a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>で作成することは推奨されていません。 </p>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>自体には仮想化に関する機能は搭載されていないため、別途仮想化ソフトウェアが必要です。現在公開されている最新版である<a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a> 1.7系では<a class="keyword" href="http://d.hatena.ne.jp/keyword/VirtualBox">VirtualBox</a>がデフォルトで利用可能な仮想化ソフトウェアとなっておりますが、Dockerや<a class="keyword" href="http://d.hatena.ne.jp/keyword/Hyper-V">Hyper-V</a>もサポートされているようです。また、別途<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D7%A5%E9%A5%B0%A5%A4%A5%F3">プラグイン</a>を導入することで<a class="keyword" href="http://d.hatena.ne.jp/keyword/VMware">VMware</a>や<a class="keyword" href="http://d.hatena.ne.jp/keyword/Xen">Xen</a>、<a class="keyword" href="http://d.hatena.ne.jp/keyword/KVM">KVM</a>、<a class="keyword" href="http://d.hatena.ne.jp/keyword/AWS">AWS</a>も利用可能になります。 </p> <a name="more"></a> <h4>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>環境構築</h4> <h5>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>のダウンロードとインストール</h5>
<p>公式サイトから、 <a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/dmg">dmg</a>をダウンロードしてインストールします。 </p>
<ul>  <li><a href="http://www.vagrantup.com/">Vagrant</a></li>
</ul> <p>インストールするとインストール実行ユーザのホーム<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リに<code>.vagrant.d</code>フォルダが作成されます。 これが<a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>のホーム<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リとなっております。 <a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>のホーム<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リを変更するには<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B4%C4%B6%AD%CA%D1%BF%F4">環境変数</a><code>VAGRANT_HOME</code>に<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リを設定します。 </p> <b> ※.<a class="keyword" href="http://d.hatena.ne.jp/keyword/vagrant">vagrant</a>.d以下の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リ</b> <pre class="terminal">  .vagrant.d         boxes         data          gems         insecure_private_key         rgloader         setup_version         tmp  </pre> <h5>VitualBoxのダウンロードとインストール</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/VirtualBox">VirtualBox</a>を公式サイトからダウンロードしてインストールします。 </p>
<ul>  <li><a href="https://www.virtualbox.org/">Oracle VM VirtualBox</a></li>
</ul> <h5>Box(<a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>で利用するイメージファイル)の追加</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>で利用する<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B2%BE%C1%DB%A5%DE%A5%B7%A5%F3">仮想マシン</a>イメージファイルをBoxといいます。 </p>
<p>boxは<code>vagrant box add</code>コマンドによって<a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>に追加されます。このコマンドは、複数の<a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>にてboxを再利用するために、特定の名前でboxを保存します。 </p>
<p>boxは下記の公式サイトから取得します。 </p>
<ul>  <li><a href="http://www.vagrantbox.es/">A list of base boxes for Vagrant - Vagrantbox.es</a></li>
</ul> <p>以下は、<a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a> 6.5のboxファイルをcentos65という名前で<a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>上に保存します。取得したファイルは<code>~/.vagrant.d/boxes/</code>へ保存されます。 </p>
<pre class="terminal">  $ vagrant box add centos65 https://github.com/2creatives/vagrant-centos/releases/download/v6.5.3/centos65-x86_64-20140116.box ==&gt; box: Adding box 'centos65' (v0) for provider:     box: Downloading: https://github.com/2creatives/vagrant-centos/releases/download/v6.5.3/centos65-x86_64-20140116.box  </pre> <p><code>vagrant box list</code>コマンドで登録されているboxファイルの一覧を確認できます。 </p>
<pre class="terminal">  $ vagrant box list centos65                         (virtualbox, 0)  </pre> <h5>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>環境作成</h5> <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>では、<code>Vagrantfile</code>というファイルに、作成する<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B2%BE%C1%DB%A5%DE%A5%B7%A5%F3">仮想マシン</a>の設定情報を記述します。 <code>vagrant init</code>コマンドを実行することで、<code>Vagrantfile</code>が生成されます。これによってカレント<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リを<a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>環境にするために初期化されます。 </p> <p>以下にCentOS6.5の<a class="keyword" href="http://d.hatena.ne.jp/keyword/VirtualBox">VirtualBox</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/%B2%BE%C1%DB%A5%DE%A5%B7%A5%F3">仮想マシン</a>用の<a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>環境作成用<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リを作成します。 </p>
<pre class="terminal">  $ mkdir -p ~/Work/vagrant/CentOS65 $ cd ~/Work/vagrant/CentOS65  </pre> <p>使用するboxファイルを指定して<code>vagrant init</code>コマンドを実行します。これによって使用するboxファイルに合った<code>Vagrantfile</code>が作成されます。 </p>
<pre class="terminal">  $ vagrant init centos65 A `Vagrantfile` has been placed in this directory. You are now ready to `vagrant up` your first virtual environment! Please read the comments in the Vagrantfile as well as documentation on `vagrantup.com` for more information on using Vagrant.  </pre>  <h5>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B2%BE%C1%DB%A5%DE%A5%B7%A5%F3">仮想マシン</a>の起動</h5> <p><code>Vagrantfile</code>を作成した<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リ内で<code>vagrant up</code>を実行して<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B2%BE%C1%DB%A5%DE%A5%B7%A5%F3">仮想マシン</a>を作成して起動できます。 </p>
<pre class="terminal">  $ vagrant up Bringing machine 'default' up with 'virtualbox' provider... ==&gt; default: Importing base box 'centos65'... ==&gt; default: Matching MAC address for NAT networking... ==&gt; default: Setting the name of the VM: vagrant_default_1443274625036_48248 ==&gt; default: Clearing any previously set network interfaces... ==&gt; default: Preparing network interfaces based on configuration...     default: Adapter 1: nat ==&gt; default: Forwarding ports...     default: 22 =&gt; 2222 (adapter 1) ==&gt; default: Booting VM... ==&gt; default: Waiting for machine to boot. This may take a few minutes...     default: SSH address: 127.0.0.1:2222     default: SSH username: vagrant     default: SSH auth method: private key     default: Warning: Connection timeout. Retrying...     default:     default: Vagrant insecure key detected. Vagrant will automatically replace     default: this with a newly generated keypair for better security.     default:     default: Inserting generated public key within guest...     default: Removing insecure key from the guest if its present...     default: Key inserted! Disconnecting and reconnecting using new SSH key... ==&gt; default: Machine booted and ready! ==&gt; default: Checking for guest additions in VM... ==&gt; default: Mounting shared folders...     default: /vagrant =&gt; /Users/shimizu/WORK/vagrant  </pre> <p>起動すると<a class="keyword" href="http://d.hatena.ne.jp/keyword/VirtualBox">VirtualBox</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リ(<code>$HOME/VirtualBox\ VMs/</code>)配下にファイルやvmdkファイルなどが作成されます。 </p> <h5>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B2%BE%C1%DB%A5%DE%A5%B7%A5%F3">仮想マシン</a>への<a class="keyword" href="http://d.hatena.ne.jp/keyword/SSH">SSH</a>接続</h5> <p><code>vagrant ssh</code>コマンドで<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B2%BE%C1%DB%A5%DE%A5%B7%A5%F3">仮想マシン</a>環境へ<a class="keyword" href="http://d.hatena.ne.jp/keyword/ssh">ssh</a>接続できます。 </p>
<pre class="terminal">  $ vagrant ssh [vagrant@vagrant-centos65 ~]$ [vagrant@vagrant-centos65 ~]$ exit logout Connection to 127.0.0.1 closed.  </pre> <h5>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B2%BE%C1%DB%A5%DE%A5%B7%A5%F3">仮想マシン</a>の停止</h5> <p><code>vagrant halt</code>コマンドで<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B2%BE%C1%DB%A5%DE%A5%B7%A5%F3">仮想マシン</a>を停止できます。 </p>
<pre class="terminal">  shimizu@MacBook-Air-Mid-2011.local ~/WORK/vagrant/centos65:$ vagrant halt ==&gt; default: Attempting graceful shutdown of VM...  </pre>  <h4>おわりに</h4>
<p>以上、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Vagrant">Vagrant</a>の基本的な使い方です。 </p>
</body>

<!-- more -->


