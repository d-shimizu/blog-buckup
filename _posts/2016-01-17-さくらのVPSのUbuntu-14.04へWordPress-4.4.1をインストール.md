---
layout: post
Categories:  ["tech"]
Description:  " はじめに  さくらのVPSのUbuntu 14.04にWordPress 4.4をインストールする手順です。 "
Tags: ["tech", "Ubuntu", "WordPress", "さくらのVPS"]
date: "2016-01-17T15:12:00+09:00"
title: "さくらのVPSのUbuntu 14.04へWordPress 4.4.1をインストール"
author: "dshimizu"
archive: ["2016"]
draft: "true"
---

<body>
<h3>はじめに</h3>


<p>さくらの<a class="keyword" href="http://d.hatena.ne.jp/keyword/VPS">VPS</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ubuntu">Ubuntu</a> 14.04に<a class="keyword" href="http://d.hatena.ne.jp/keyword/WordPress">WordPress</a> 4.4をインストールする手順です。</p>
</body>

<!-- more -->

<body>
<h3>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/WordPress">WordPress</a> 4.4.1のセットアップ手順</h3>


<h4>環境</h4>


<p>環境は以下です。</p>

<table>
<tbody>
<tr>
<th>OS</th>
<td>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ubuntu">Ubuntu</a> 14.04.3 LTS(3.13.0-66-generic)</td>
</tr>
</tbody>
</table>


<p>利用するアプリケーションは以下です。</p>

<table>
<tbody>
<tr>
<th><a class="keyword" href="http://d.hatena.ne.jp/keyword/WordPress">WordPress</a></th>
<td>Version 4.4</td>
</tr>
<tr>
<th><a class="keyword" href="http://d.hatena.ne.jp/keyword/PHP">PHP</a></th>
<td>Version 5.5.9(<a class="keyword" href="http://d.hatena.ne.jp/keyword/deb">deb</a>パッケージ)</td>
</tr>
<tr>
<th>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/PHP">PHP</a>-FPM</th>
<td>Version 5.5.9(<a class="keyword" href="http://d.hatena.ne.jp/keyword/deb">deb</a>パッケージ)</td>
</tr>
<tr>
<th>Nginx</th>
<td>Version 1.4.6-1(<a class="keyword" href="http://d.hatena.ne.jp/keyword/deb">deb</a>パッケージ)</td>
</tr>
<tr>
<th><a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a></th>
<td>Version 5.5.46-0(<a class="keyword" href="http://d.hatena.ne.jp/keyword/deb">deb</a>パッケージ)</td>
</tr>
</tbody>
</table>


<table>
<tbody>
<tr>
<th>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/WordPress">WordPress</a>用 Nginx ドキュメントルート</th>
<td>/usr/share/nginx/www/<a class="keyword" href="http://d.hatena.ne.jp/keyword/wordpress">wordpress</a>
</td>
</tr>
<tr>
<th>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/WordPress">WordPress</a>用 <a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>ユーザ名</th>
<td>wp</td>
</tr>
<tr>
<th>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/WordPress">WordPress</a>用 <a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a> DB名</th>
<td>wp</td>
</tr>
</tbody>
</table>


<h4>必要パッケージのインストール</h4>


<p>Nginx, <a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>, PHP5関連のパッケージをインストールします。</p>

<pre class="terminal"> $ sudo apt install nginx mysql-server php5 php-fpm php5-mysql php5-gd
 </pre>


<h4>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/WordPress">WordPress</a>の取得</h4>


<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/WordPress">WordPress</a>の公式ページ<a href="https://ja.wordpress.org/" target="_blank" rel="noopener noreferrer">WordPress | 日本語</a>から
最新版の<a class="keyword" href="http://d.hatena.ne.jp/keyword/WordPress">WordPress</a>を取得します。
本記事記載時点での最新版は4.4.1でしたのでそれをインストールします。</p>

<pre class="terminal"> $ wget -P /tmp  https://ja.wordpress.org/wordpress-4.4-ja.tar.gz
 </pre>


<p>Nginxのドキュメントルートに展開します。</p>

<pre class="terminal"> $ sudo tar -xzvf wordpress-4.4.1-ja.tar.gz -C  /usr/share/nginx/www
 </pre>


<h4>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/PHP">PHP</a>-FPMの設定</h4>


<p>Nignxと<a class="keyword" href="http://d.hatena.ne.jp/keyword/PHP">PHP</a>の接続を<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unix">Unix</a> <a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C9%A5%E1%A5%A4%A5%F3">ドメイン</a>ソケットで行うことにします。
<code>listen = /var/run/php5-fpm.sock</code>を追記します。</p>

<pre class="terminal"> $ sudo vim /etc/php5/fpm/pool.d/www.conf
listen = /var/run/php5-fpm.sock
 </pre>


<h4>Nginxの設定</h4>


<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A2%A5%AF%A5%BB%A5%B9%A5%ED%A5%B0">アクセスログ</a>保存先の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リを作成します。</p>

<pre class="terminal"> $ sudo mkdir /var/log/nginx/wordpress
 </pre>


<p>Nginxの設定ファイルを作成します。
ファイル名はなんでも構いませんので、ここでは<code>wordpress.conf</code>としています。</p>

<pre class="terminal"> $ sudo vim /etc/nginx/conf.d/wordpress.conf
 </pre>


<p>以下のような設定を行います。</p>

<pre class="terminal"> upstream php-fpm-socket {
  ###php-fpmで設定したUnixドメインソケットのPATHを指定
  server unix:/var/run/php5-fpm.sock;
}

server {
    listen 80;
    index index.html index.htm index.php;
    server_name [サイトのドメイン名];

    ###WordPressのドキュメントルートを指定
    root /usr/share/nginx/www/wordpress;
    index index.html;

    ###ログ保存先を指定
    access_log /var/log/nginx/wordpress/access.log;
    error_log /var/log/nginx/wordpress/error.log;

    ###パーマリンクをデフォルトから変更した場合、
    ###リクエストを受け付け、ソースが見つからないリクエストをindex.phpへ飛ばす。
    location / {
        try_files $uri $uri/ /index.php;
    }

    ###通常の.phpでのアクセスを処理する設定
    ###ソースが存在しないリクエストをindex.phpへ飛ばす。
    location ~ \.php$ {
        try_files $uri /index.php;
        fastcgi_split_path_info ^(.+\.php)(.*)$;
        fastcgi_pass php-fpm-socket;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
 </pre>


<h4>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>の設定</h4>


<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>で<a class="keyword" href="http://d.hatena.ne.jp/keyword/WordPress">WordPress</a>用のデータベースとユーザを作成します。</p>

<pre class="terminal"> $ mysql -u root -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 5340 to server version: 3.23.54
 
Type 'help;' or '\h' for help. Type '\c' to clear the buffer.
 
### DB作成
mysql&gt; CREATE DATABASE wp;
Query OK, 1 row affected (0.00 sec)
 
### ユーザ作成
mysql&gt; GRANT ALL PRIVILEGES ON wp.* TO "wp"@"localhost"
    -&gt; IDENTIFIED BY "****************";
Query OK, 0 rows affected (0.00 sec)
  
### 必要ないけど公式手順にあるのできさい　
mysql&gt; FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.01 sec)

### MySQLサーバからログアウト
mysql&gt; EXIT
Bye
 </pre>


<h4>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/WordPress">WordPress</a>の設定</h4>


<p><code>wp-config.php</code>で<a class="keyword" href="http://d.hatena.ne.jp/keyword/WordPress">WordPress</a>の環境設定を行います。
最初は存在しないので、<code>wp-config-sample.php</code>を<code>wp-config.php</code>としてコピーします。</p>

<pre class="terminal"> $ sudo cp -pr /usr/share/nginx/www/wordpress/wp-config-sample.php /usr/share/nginx/www/wordpress/wp-config.php
 </pre>


<p><code>wp-config.php</code>を編集します。</p>

<pre class="terminal"> $ sudo vim /usr/share/nginx/www/wordpress/wp-config.php
 </pre>


<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>に作成したデータベース名、ユーザ名、パスワードを設定します。</p>

<pre class="terminal"> /** WordPress のためのデータベース名 */
define('DB_NAME', 'wp');

/** MySQL データベースのユーザー名 */
define('DB_USER', 'wp');

/** MySQL データベースのパスワード */
define('DB_PASSWORD', '****************');

/** MySQL のホスト名 */
define('DB_HOST', 'localhost');
 </pre>


<p><a href="https://api.wordpress.org/secret-key/1.1/salt/" target="_blank" rel="noopener noreferrer">WordPress.org の秘密鍵サービス</a> を使って認証用ユニークキーを作成し、以下の<code>put your unique phrase here</code>の欄に設定します。
これは<a class="keyword" href="http://d.hatena.ne.jp/keyword/Cookie">Cookie</a> に格納される情報の暗号化に使われます。</p>

<pre class="terminal"> define('AUTH_KEY',         'put your unique phrase here');
define('SECURE_AUTH_KEY',  'put your unique phrase here');
define('LOGGED_IN_KEY',    'put your unique phrase here');
define('NONCE_KEY',        'put your unique phrase here');
define('AUTH_SALT',        'put your unique phrase here');
define('SECURE_AUTH_SALT', 'put your unique phrase here');
define('LOGGED_IN_SALT',   'put your unique phrase here');
define('NONCE_SALT',       'put your unique phrase here');
 </pre>


<h4>インストール<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8">スクリプト</a>の実行</h4>


<p>自サイトのURLにアクセスして、<code>install.php</code>を実行します。</p>

<p>http://サイトの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C9%A5%E1%A5%A4%A5%F3">ドメイン</a>/wp-admin/install.<a class="keyword" href="http://d.hatena.ne.jp/keyword/php">php</a></p>

<p>以下のような画面が表示されますので、必要事項を入力します。
<img src="http://blog.dshimizu.jp/wp-content/uploads/2016/01/wordpress_install.png"></p>

<p>以下のような画面が表示されれば完了です。
<a class="keyword" href="http://d.hatena.ne.jp/keyword/WordPress">WordPress</a>のユーザ名/パスワードを入力して管理画面にログインします。
<img src="http://blog.dshimizu.jp/wp-content/uploads/2016/01/wordpress_install_2.png"></p>

<h3>おわりに</h3>


<p>以上、<a class="keyword" href="http://d.hatena.ne.jp/keyword/WordPress">WordPress</a> 4.4.1のインストールでした。</p>

<h3>参考</h3>


<ul>
    <li><a href="http://wpdocs.osdn.jp/WordPress_%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" target="_blank" rel="noopener noreferrer">WordPress のインストール - WordPress Codex 日本語版</a></li>
    <li><a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#try_files" target="_blank" rel="noopener noreferrer">Module ngx_http_core_module </a></li>
</ul>

</body>
