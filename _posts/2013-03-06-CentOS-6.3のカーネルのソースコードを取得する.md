---
layout: post
Categories:  ["tech"]
Description:  " はじめに  いろいろな書籍や雑誌、WEBサイトの記事等を読んでいくなかで、Linuxカーネルのソースコードを見たい時(きちんと読める訳ではありませんが…)が何度かありましたので、自身のCentOS 6.3環境にソースコードを取得して、それ"
Tags: ["CentOS", "カーネル"]
date: "2013-03-06T00:17:00+09:00"
title: "CentOS 6.3のカーネルのソースコードを取得する"
author: "dshimizu"
archive: ["2013"]
draft: "true"
---

<body>
<h4>はじめに</h4>
<p>いろいろな書籍や雑誌、WEBサイトの記事等を読んでいくなかで、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AB%A1%BC%A5%CD%A5%EB">カーネル</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>を見たい時(きちんと読める訳ではありませんが…)が何度かありましたので、自身の<a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a> 6.3環境に<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>を取得して、それを参照できるようにしてみました。 </p>
<a name="more"></a> <h4>環境</h4>
<p>実施した際の環境は以下の通りです。 </p>
<table>  <tr>    <td bgcolor="#cccccc">OS</td>    <td>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a> 6.3 <a class="keyword" href="http://d.hatena.ne.jp/keyword/x86">x86</a>_64 (64bit)</td>  </tr>  <tr>    <td bgcolor="#cccccc">
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AB%A1%BC%A5%CD%A5%EB">カーネル</a>バージョン</td>    <td>2.6.32-279.22.1.el6.<a class="keyword" href="http://d.hatena.ne.jp/keyword/x86">x86</a>_64</td>  </tr>
</table> <h4>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AB%A1%BC%A5%CD%A5%EB">カーネル</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>のダウンロード手順</h4>
<h5>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Yum">Yum</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EA%A5%DD%A5%B8%A5%C8%A5%EA">リポジトリ</a>の設定</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a> 6.2から<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>が <a href="http://vault.centos.org">http://vault.centos.org</a> に配置されているようですので、<a class="keyword" href="http://d.hatena.ne.jp/keyword/yum">yum</a>でこれを参照できるように<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EA%A5%DD%A5%B8%A5%C8%A5%EA">リポジトリ</a>の設定を行います。 </p>
<ul>  <li><a href="http://wiki.centos.org/Manuals/ReleaseNotes/CentOS6.2#head-f81b21ac77901a35cac641d9573e74f21c2c9cd3">7. Sources - CentOS 6.2 Release Notes</a></li>  <li><a href="http://wiki.centos.org/Manuals/ReleaseNotes/CentOS6.2#head-f81b21ac77901a35cac641d9573e74f21c2c9cd3">8. Sources - CentOS 6.3 Release Notes</a></li>
</ul>
<p>rootにスイッチします。 </p>
<pre class="terminal">  $ su - パスワード：  
</pre>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a>-Source.repoという<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EA%A5%DD%A5%B8%A5%C8%A5%EA">リポジトリ</a>設定ファイルを作成し、以下のような内容を記載します。 </p>
<pre class="terminal">  # cd /etc/yum.repos.d  
</pre>
<pre class="terminal">  # vim CentOS-Source.repo [base-source] name=CentOS-$releasever - Base Source baseurl=http://vault.centos.org/$releasever/os/Source/ gpgcheck=1 enabled=0 gpgkey=http://vault.centos.org/RPM-GPG-KEY-CentOS-6  [updates-source] name=CentOS-$releasever - Updates Source baseurl=http://vault.centos.org/$releasever/updates/Source/ gpgcheck=1 enabled=0 gpgkey=http://vault.centos.org/RPM-GPG-KEY-CentOS-6  [extras-source] name=CentOS-$releasever - Extras Source baseurl=http://vault.centos.org/$releasever/extras/Source/ gpgcheck=1 enabled=0 gpgkey=http://vault.centos.org/RPM-GPG-KEY-CentOS-6  
</pre>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EA%A5%DD%A5%B8%A5%C8%A5%EA">リポジトリ</a>の設定はこれで完了です。 </p> <h5>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/RPM">RPM</a>パッケージのダウンロード</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>を<a class="keyword" href="http://d.hatena.ne.jp/keyword/RPM">RPM</a>パッケージをダウンロードします。<br>作業用の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リを作成します。ここでは/tmp配下にkernelという<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リを作成しています。 </p>
<pre class="terminal">  # mkdir -p /tmp/kernel  
</pre>
<p>作成した<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リに移動します。 </p>
<pre class="terminal">  # cd /tmp/kernel  
</pre>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a> 6.3の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AB%A1%BC%A5%CD%A5%EB">カーネル</a>をダウンロードします。--releaseverオプションでバージョンを指定します。 </p>
<pre class="terminal">  # yumdownloader --source kernel --releasever=6.3  
</pre>
<p>以下のファイルが取得されています。 </p>
<pre class="terminal">  # ls kernel-2.6.32-279.22.1.el6.src.rpm  </pre> <h5>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/RPM">RPM</a>パッケージから<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>のファイルの取得</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/RPM">RPM</a>パッケージからファイルを取り出します。これを実施するには<a class="keyword" href="http://d.hatena.ne.jp/keyword/RPM">RPM</a>パッケージをcpio形式の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A2%A1%BC%A5%AB%A5%A4%A5%D6">アーカイブ</a>ファイルに変換し、cpioコマンドで取り出すことができます。具体的なオペレーション手順としては、rpm2cpioコマンドで<a class="keyword" href="http://d.hatena.ne.jp/keyword/RPM">RPM</a>ファイルをcpioファイルに変換し、標準出力に出力されるcpio形式の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A2%A1%BC%A5%AB%A5%A4%A5%D6">アーカイブ</a>をパイプでcpioに渡して展開します。 </p>
<pre class="terminal">  # rpm2cpio kernel-2.6.32-279.22.1.el6.src.rpm | cpio -id 167602 blocks  
</pre>
<p>いくつかのファイルが生成されますが、その中に<a class="keyword" href="http://d.hatena.ne.jp/keyword/linux">linux</a>-2.6.32-279.22.1.el6.tar.bz2というファイルがあります。これを展開します。 </p>
<pre class="terminal">  # tar -xjvf linux-2.6.32-279.22.1.el6.tar.bz2  
</pre>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/linux">linux</a>-2.6.32-279.22.1.el6<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リが作成され、その配下に<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AB%A1%BC%A5%CD%A5%EB">カーネル</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>類が配置されています。 </p>
<pre class="terminal">  # cd linux-2.6.32-279.22.1.el6  
</pre>
<pre class="terminal">  # ls COPYING        Makefile         block     include   lib      security CREDITS        Makefile.common  crypto    init      mm       sound Documentation  README           drivers   ipc       net      tools Kbuild         REPORTING-BUGS   firmware  kabitool  samples  usr MAINTAINERS    arch             fs        kernel    scripts  virt  
</pre>
<p>これで<a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a> 6.3の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>の取得ができました。<br>私は<a class="keyword" href="http://d.hatena.ne.jp/keyword/Apache">Apache</a>のドキュメントルート以下の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リに<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B7%A5%F3%A5%DC%A5%EA%A5%C3%A5%AF%A5%EA%A5%F3%A5%AF">シンボリックリンク</a>を張って、httpでWEB上から参照できるようにしています。 </p> <h4>おわりに</h4>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AB%A1%BC%A5%CD%A5%EB">カーネル</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>を解読するのは今の自分にかなりハードルが高いですが、OSの仕組みを知る上では<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AB%A1%BC%A5%CD%A5%EB">カーネル</a>の仕組みを理解するのは大事なことだと思いますので、少しずつ目を通して理解を深めていきたいと思います。 </p>
<p></p>
</body>

<!-- more -->


