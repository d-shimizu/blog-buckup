---
layout: post
Categories:  ["tech"]
Description:  " はじめに   2015/8/13 FreeBSD 10.2-RELEASEが公開されました。      FreeBSD 10.2-RELEASE Announcement    FreeBSD 10.2-RELEASE Release N"
Tags: ["FreeBSD"]
date: "2015-08-16T16:45:00+09:00"
title: "FreeBSD 10.1-RELEASEをFreeBSD 10.2-RELEASEへアップグレード"
author: "dshimizu"
archive: ["2015"]
draft: "true"
---

<body>
<h4>はじめに</h4> <p>2015/8/13 <a class="keyword" href="http://d.hatena.ne.jp/keyword/FreeBSD">FreeBSD</a> 10.2-RELEASEが公開されました。 </p>
<ul>  <li><a href="https://www.freebsd.org/releases/10.2R/announce.html">FreeBSD 10.2-RELEASE Announcement</a></li>  <li><a href="https://www.freebsd.org/releases/10.2R/relnotes.html">FreeBSD 10.2-RELEASE Release Notes</a></li>
</ul>
<p>さくらの<a class="keyword" href="http://d.hatena.ne.jp/keyword/VPS">VPS</a>で使っている<a class="keyword" href="http://d.hatena.ne.jp/keyword/FreeBSD">FreeBSD</a> 10.1-RELEASEを10.2-RELEASEへアップグレードしてみましたので、その際に実施した手順を記載します。 </p> <a name="more"></a> <h4>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/FreeBSD">FreeBSD</a> 10.1-RELEASEを10.2-RELEASEへアップグレード</h4>
<p>公式マニュアルの手順を元に、アップデートを実施します。 </p> <ul>  <li><a href="https://www.freebsd.org/doc/ja/books/handbook/updating-upgrading-freebsdupdate.html#freebsdupdate-upgrade">18.2. FreeBSD Update - 18.2.3. メジャーおよびマイナーバージョンのアップグレードを行う</a></li>
</ul> <h5>実行環境</h5>
<p>実行環境は以下となります。  </p>
<table>
<tr>  <td bgcolor="#cccccc">プラットフォーム</td>  <td>さくらの<a class="keyword" href="http://d.hatena.ne.jp/keyword/VPS">VPS</a> 512</td>
</tr>
<tr>  <td bgcolor="#cccccc">OS</td>  <td>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/FreeBSD">FreeBSD</a> 10.1-RELEASE-p0 (<a class="keyword" href="http://d.hatena.ne.jp/keyword/amd64">amd64</a>)</td>
</tr>
</table> <h5>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/FreeBSD">FreeBSD</a>のアップグレード</h5>
<p>アップグレードを実施します。まず、rootにスイッチします。 </p>
<pre class="terminal">  &gt; su -  </pre> <h6>アップグレード</h6>
<p><code>freebsd-update</code>コマンドを使ってFreeBSD10.1-RELEASEを<a class="keyword" href="http://d.hatena.ne.jp/keyword/FreeBSD">FreeBSD</a> 10.2-RELEASEへアップグレードします。 </p>
<pre class="terminal">  # freebsd-update -r 10.2-RELEASE upgrade  </pre> <p>更新対象となるファイルに対して、<code>Does this look reasonable (y/n)?</code>(変更に問題ないか？)といったことを何度か聞かれるので、一応確認して問題なければ<code>y</code>(yes)と入力します。 </p>
<pre class="terminal">  Looking up update.FreeBSD.org mirrors... none found. Fetching metadata signature for 10.1-RELEASE from update.FreeBSD.org... done. Fetching metadata index... done. Fetching 2 metadata patches.. done. Applying metadata patches... done. Fetching 1 metadata files... done. Inspecting system... done.  The following components of FreeBSD seem to be installed: kernel/generic src/src world/base  The following components of FreeBSD do not seem to be installed: world/doc world/games world/lib32  Does this look reasonable (y/n)? y  Fetching metadata signature for 10.2-RELEASE from update.FreeBSD.org... done. Fetching metadata index... done. Fetching 1 metadata patches. done. Applying metadata patches... done. Fetching 1 metadata files... done. Inspecting system... done. Fetching files from 10.1-RELEASE for merging... done. Preparing to download files... done. Fetching 41092 patches.....10....20....30....40....50....60....70....80....90....100....110....120....130....140....150....160....170.... ： ： ： 40930....40940....40950....40960....40970....40980....40990....41000....41010....41020....41030....41040....41050....41060....41070....41080....41090. done. Applying patches... done. Fetching 4756 files... done. Attempting to automatically merge changes in files... done.  The following changes, which occurred between FreeBSD 10.1-RELEASE and FreeBSD 10.2-RELEASE have been merged into /etc/ntp.conf: --- current version +++ new version @@ -1,7 +1,7 @@  # -# $FreeBSD: releng/10.1/etc/ntp.conf 259974 2013-12-27 23:09:40Z delphij $ +# $FreeBSD: releng/10.2/etc/ntp.conf 285612 2015-07-15 19:21:26Z delphij $ ： ： ： /var/db/etcupdate/current/root/.login /var/db/etcupdate/current/root/.profile /var/db/etcupdate/log /var/db/mergemaster.mtree /var/yp/Makefile.dist To install the downloaded upgrades, run "/usr/sbin/freebsd-update install".  </pre>  <h6>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AB%A1%BC%A5%CD%A5%EB">カーネル</a>/<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AB%A1%BC%A5%CD%A5%EB">カーネル</a>モジュール更新</h6>
<p>更新ファイルはまだ反映されていないので、上記<code>freebsd-update</code>コマンド実行後の最後のメッセージにある通りに、<code>freebsd-update install</code>コマンドを実行します。 </p>
<pre class="terminal">  # freebsd-update install  
</pre>
<p>更新が反映(ディスクへ書き込み)されます。 </p>
<pre class="terminal">  Installing updates... Kernel updates have been installed.  Please reboot and run "/usr/sbin/freebsd-update install" again to finish installing updates.  
</pre>
<p>上記メッセージに表示されているとおり、OS再起動を実施し、新しい<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AB%A1%BC%A5%CD%A5%EB">カーネル</a>(10.2-RELEASE)で起動させます。 </p>
<pre class="terminal">  # shutdown -r now  </pre> <p>起動後、OSバージョンが10.2-RELEASEとなっていることを確認します。 </p>
<pre class="terminal">  &gt; uname -r 10.2-RELEASE  </pre> <h6>古いライブラリ/ファイル類の削除</h6>
<p>rootへスイッチします。 </p>
<pre class="terminal">  &gt; su -  
</pre>
<p>再び<a class="keyword" href="http://d.hatena.ne.jp/keyword/freebsd">freebsd</a>-updateコマンドを実行します。 </p>
<pre class="terminal">  # /usr/sbin/freebsd-update install  
</pre>
<p>古い共有ライブラリとオブジェクトファイルを削除されます。 </p>
<pre class="terminal">  Installing updates... Completing this upgrade requires removing old shared object files. Please rebuild all installed 3rd party software (e.g., programs installed from the ports tree) and then run "/usr/sbin/freebsd-update install" again to finish installing updates  </pre> <h6>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/ZFS">ZFS</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D5%A5%A1%A5%A4%A5%EB%A5%B7%A5%B9%A5%C6%A5%E0">ファイルシステム</a>とストレージプールの更新</h6>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D5%A5%A1%A5%A4%A5%EB%A5%B7%A5%B9%A5%C6%A5%E0">ファイルシステム</a>に<a class="keyword" href="http://d.hatena.ne.jp/keyword/ZFS">ZFS</a>を使用している場合、現在動作している<a class="keyword" href="http://d.hatena.ne.jp/keyword/ZFS">ZFS</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D5%A5%A1%A5%A4%A5%EB%A5%B7%A5%B9%A5%C6%A5%E0">ファイルシステム</a>とストレージプールに対して以下のコマンドを実行してアップグレードを実行します。 </p>
<pre class="terminal">  # zpool upgrade -a  
</pre>
<pre class="terminal">  This system supports ZFS pool feature flags.  Enabled the following features on 'rpool':   spacemap_histogram   enabled_txg   hole_birth   extensible_dataset   embedded_data   bookmarks   filesystem_limits  If you boot from pool 'rpool', don't forget to update boot code. Assuming you use GPT partitioning and da0 is your boot disk the following command will do it:          gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 da0  
</pre>
<p>メッセージの最後に表示されている通り、ディスクにbootコードを書き見ます。 </p>
<pre class="terminal">  # gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 ada0 bootcode written to ada0  </pre> <h6>パッケージのアップデート</h6>
<p>最新のバイナリパッケージへアップデートします。 </p>
<pre class="terminal">  # pkg upgrade -f  </pre> <h4>おわりに</h4>
<p>以上で、<a class="keyword" href="http://d.hatena.ne.jp/keyword/FreeBSD">FreeBSD</a> 10.1-RELEASEから10.2-RELEASEへの更新が完了しました。 </p>
</body>

<!-- more -->


