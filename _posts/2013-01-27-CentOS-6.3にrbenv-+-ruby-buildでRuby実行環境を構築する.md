---
layout: post
Categories:  ["tech"]
Description:  " はじめに  MacにRuby実行環境を構築してみましたが、さくらのVPS上のCentOS 6.3にもrbenvと、Rubyインストール用のrbenvプラグインであるruby-buildを利用してRuby実行環境を構築してみました。    "
Tags: ["Ruby", "rbenv", "さくらのVPS", "環境構築", "CentOS"]
date: "2013-01-27T23:45:00+09:00"
title: "CentOS 6.3にrbenv + ruby-buildでRuby実行環境を構築する"
author: "dshimizu"
archive: ["2013"]
draft: "true"
---

<body>
<h4>はじめに</h4>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Mac">Mac</a>に<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>実行環境を構築してみましたが、さくらの<a class="keyword" href="http://d.hatena.ne.jp/keyword/VPS">VPS</a>上の<a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a> 6.3にもrbenvと、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>インストール用のrbenv<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D7%A5%E9%A5%B0%A5%A4%A5%F3">プラグイン</a>である<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>-buildを利用して<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>実行環境を構築してみました。 </p>
<ul>  <li><a href="https://github.com/sstephenson/rbenv">README.md - sstephenson / rbenv</a></li>  <li><a href="https://github.com/sstephenson/ruby-build">README.md - sstephenson / ruby-build</a></li>
</ul>
<a name="more"></a><p><a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a>のパッケージ管理システムである<a class="keyword" href="http://d.hatena.ne.jp/keyword/Yum">Yum</a>の標準<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EA%A5%DD%A5%B8%A5%C8%A5%EA">リポジトリ</a>にはrbenvや<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>-buildはないので、上記リンク先の公式手順通りに<a class="keyword" href="http://d.hatena.ne.jp/keyword/github">github</a>からソースを取得してインストールします。 </p> <h4>インストール環境</h4>
<p>インストール環境は以下です。 </p>
<table>
<tr>  <td bgcolor="#cccccc">プラットフォーム</td>  <td>さくらの<a class="keyword" href="http://d.hatena.ne.jp/keyword/VPS">VPS</a>(1G <a class="keyword" href="http://d.hatena.ne.jp/keyword/SSD">SSD</a>モデル)</td>
</tr>
<tr>  <td bgcolor="#cccccc">OS</td>  <td>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a> 6.3 <a class="keyword" href="http://d.hatena.ne.jp/keyword/x86">x86</a>_64 (64bit)</td>
</tr>
<tr>  <td bgcolor="#cccccc">rbenvインストール先</td>  <td>/usr/local/src</td>
</tr>
<tr>  <td bgcolor="#cccccc">
<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>-buildインストール先</td>  <td>/usr/local/src/rbenv/share/<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>-build</td>
</tr>
</table> <h4>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>実行環境の構築</h4>
<p>/usr/local/src配下にインストールするので、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%DF%A5%C3%A5%B7%A5%E7%A5%F3">パーミッション</a>の関係もあるため、作業は全てrootで実行します。 </p>
<pre class="terminal">  % su - パスワード:  </pre> <h5>事前準備</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>のインストール時にC<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%E9">コンパイラ</a>を必要とします。 また、<a class="keyword" href="http://d.hatena.ne.jp/keyword/github">github</a>からrbenv, <a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>-buildを取得するためにgitのコマンドが必要です。 <a class="keyword" href="http://d.hatena.ne.jp/keyword/gcc">gcc</a>, make, git, opensslパッケージが必要ですので、事前にインストールしておきます。 </p>
<pre class="terminal">  # yum install gcc make git openssl-devel  </pre> <h5>rbenvのインストール</h5>
<p>公式手順を元にインストールを行います。 </p>
<ul>  <li><a href="https://github.com/sstephenson/rbenv#installation">Installation - sstephenson / rbenv</a></li>
</ul>
<p>インストール先となる<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リ(/usr/local/src)へ移動し、<a class="keyword" href="http://d.hatena.ne.jp/keyword/github">github</a>からrbenvを取得して配置します。 </p>
<pre class="terminal">  # cd /usr/local/src  
</pre>
<pre class="terminal">  # git clone git://github.com/sstephenson/rbenv.git  
</pre>
<p>※git<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D7%A5%ED%A5%C8%A5%B3%A5%EB">プロトコル</a>が通らない場合は、httpを利用します。 </p>
<pre class="terminal">  # git clone http://github.com/sstephenson/rbenv.git  
</pre>
<p>rbenv用の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B4%C4%B6%AD%CA%D1%BF%F4">環境変数</a>を.bashrcを設定します。 </p>
<pre class="terminal">  # vim ~/.bashrc ### 以下を追記 export PATH=$PATH:/usr/local/src/rbenv/bin export RBENV_DIR="/usr/local/src/rbenv" export RBENV_ROOT="/usr/local/src/rbenv" eval "$(rbenv init -)" ###  
</pre>
<p>設定した<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B4%C4%B6%AD%CA%D1%BF%F4">環境変数</a>を読み込みます。 </p>
<pre class="terminal">  # source ~/.bashrc  </pre> <h5>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>-buildのインストール</h5>
<p>公式手順を元にインストールを行います。 </p>
<ul>  <li><a href="https://github.com/sstephenson/ruby-build#installation">Installation - sstephenson / ruby-build</a></li>
</ul>
<p>まず、<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>-buildの配置先<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リ(/usr/local/src/rbenv/plugins)を作成します。 </p>
<pre class="terminal">  # mkdir /usr/local/src/rbenv/plugins  
</pre>
<p>/usr/local/src/rbenv/plugins配下へ<a class="keyword" href="http://d.hatena.ne.jp/keyword/github">github</a>から<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>-buildを取得します。 </p>
<pre class="terminal">  # cd /usr/local/src/rbenv/plugins  
</pre>
<pre class="terminal">  # git clone git://github.com/sstephenson/ruby-build.git  
</pre>
<p>※git<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D7%A5%ED%A5%C8%A5%B3%A5%EB">プロトコル</a>が通らない場合は、httpを利用します。 </p>
<pre class="terminal">  # git clone http://github.com/sstephenson/ruby-build.git  
</pre>
<p>インストール<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8">スクリプト</a>を実行します。 </p>
<pre class="terminal">  # cd /usr/local/src/rbenv/plugins/ruby-build  
</pre>
<pre class="terminal">  # ./install.sh  Installed ruby-build at /usr/local/src/rbenv  </pre> <h5>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>のインストール</h5>
<p>rbenvと<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>-buildを利用して、<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>をインストールします。 まず、インストール可能な<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のバージョン一覧を確認してみます。 </p>
<pre class="terminal">  # rbenv install -l Available versions:   1.8.6-p383   1.8.6-p420   1.8.7-p249   1.8.7-p302   1.8.7-p334   1.8.7-p352   1.8.7-p357   1.8.7-p358   1.8.7-p370   1.8.7-p371   1.9.1-p378   1.9.2-p180   1.9.2-p290   1.9.2-p318   1.9.2-p320   1.9.3-dev   1.9.3-p0   1.9.3-p125   1.9.3-p194   1.9.3-p286   1.9.3-p327   1.9.3-p362   1.9.3-p374   1.9.3-preview1   1.9.3-rc1   2.0.0-dev   2.0.0-preview1   2.0.0-preview2   2.0.0-rc1   jruby-1.5.6   jruby-1.6.3   jruby-1.6.4   jruby-1.6.5   jruby-1.6.5.1   jruby-1.6.6   jruby-1.6.7   jruby-1.6.7.2   jruby-1.6.8   jruby-1.7.0   jruby-1.7.0-preview1   jruby-1.7.0-preview2   jruby-1.7.0-rc1   jruby-1.7.0-rc2   jruby-1.7.1   jruby-1.7.2   maglev-1.0.0   maglev-1.1.0-dev   rbx-1.2.4   rbx-2.0.0-dev   rbx-2.0.0-rc1   ree-1.8.6-2009.06   ree-1.8.7-2009.09   ree-1.8.7-2009.10   ree-1.8.7-2010.01   ree-1.8.7-2010.02   ree-1.8.7-2011.03   ree-1.8.7-2011.12   ree-1.8.7-2012.01   ree-1.8.7-2012.02  
</pre>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby%201.9">Ruby 1.9</a>.3と1.8.7の最新をインストールしてみます。 <a class="keyword" href="http://d.hatena.ne.jp/keyword/Mac">Mac</a>と異なり、<a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%E9">コンパイラ</a>は<a class="keyword" href="http://d.hatena.ne.jp/keyword/GCC">GCC</a>なので、どの<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>でも簡単にインストールすることができます。 </p>
<pre class="terminal">  # rbenv install 1.9.3-p374 Downloading yaml-0.1.4.tar.gz... -&gt; http://dqw8nmjcqpjn7.cloudfront.net/36c852831d02cf90508c29852361d01b Installing yaml-0.1.4... Installed yaml-0.1.4 to /root/.rbenv/versions/1.9.3-p374  Downloading ruby-1.9.3-p374.tar.gz... -&gt; http://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.3-p374.tar.gz Installing ruby-1.9.3-p374... Installed ruby-1.9.3-p374 to /root/.rbenv/versions/1.9.3-p374  
</pre>
<pre class="terminal">  # rbenv install 1.8.7-p371 Downloading ruby-1.8.7-p371.tar.gz... -&gt; http://ftp.ruby-lang.org/pub/ruby/1.8/ruby-1.8.7-p371.tar.gz Installing ruby-1.8.7-p371... Installed ruby-1.8.7-p371 to /root/.rbenv/versions/1.8.7-p371  Downloading rubygems-1.6.2.tar.gz... -&gt; http://dqw8nmjcqpjn7.cloudfront.net/0c95a9869914ba1a45bf71d3b8048420 Installing rubygems-1.6.2... Installed rubygems-1.6.2 to /root/.rbenv/versions/1.8.7-p371  
</pre>
<p>rbenvでインストールされた<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のバージョン一覧を以下コマンドで確認できます。 </p>
<pre class="terminal">  # rbenv versions   1.8.7-p371   1.9.3-p374  
</pre>
<p>システム全体で利用する<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のバージョンを指定します。 </p>
<pre class="terminal">  # rbenv global 1.9.3-p374  
</pre>
<p>"rbenv rehash"を実行します。 これにより、$RBENV_ROOT/shims<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リ配下に<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>やgemでインストールしたツールを起動するための実行ファイルが作成されます。 </p>
<pre class="terminal">  # rbenv rehash  
</pre>
<p>現在設定されている<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のバージョンを確認してみます。 </p>
<pre class="terminal">  # rbenv version 1.9.3-p374 (set by /usr/local/src/rbenv/version)  
</pre>
<p>rbenv管理でインストールされた<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>の一覧は下記で取得できます。 </p>
<pre class="terminal">  # rbenv versions   1.8.7-p371 * 1.9.3-p374 (set by /usr/local/src/rbenv/version)  
</pre>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のインストール先やバージョンを確認してみます。 </p>
<pre class="terminal">  # which ruby /usr/local/src/rbenv/shims/ruby  
</pre>
<pre class="terminal">  # ruby -v ruby 1.9.3p374 (2013-01-15 revision 38858) [x86_64-linux]  </pre> <h4>おわりに</h4>
<p>以上で、<a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a> 6.3に<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>の実行環境が構築できました。 </p>
</body>

<!-- more -->


