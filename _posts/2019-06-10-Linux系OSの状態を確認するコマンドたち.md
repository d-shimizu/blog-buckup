---
layout: post
Categories:  ["tech"]
Description:  " Linux系OSでのシステムの状態を確認する際に使うコマンドをメモがてら記載しておく。 "
Tags: ["Linux", "tech"]
date: "2019-06-10T23:01:00+09:00"
title: "Linux系OSの状態を確認するコマンドたち"
author: "dshimizu"
archive: ["2019"]
draft: "true"
---

<body>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a>系OSでのシステムの状態を確認する際に使うコマンドをメモがてら記載しておく。</p>
</body>

<!-- more -->

<body>
<h3>ログインした直後に見ること</h3>


<p>サーバの起動時刻を見る。</p>

<pre class="terminal"> :$ uptime
 </pre>


<p>サーバのホスト名等を見る。</p>

<pre class="terminal"> :$ uname -a
 </pre>


<p>現在ログイン中のユーザを見る。</p>

<pre class="terminal"> :$ w
 </pre>


<h3>全体の情報を見る</h3>


<pre class="terminal"> :$ dstat -af
 </pre>


<pre class="terminal"> :$ sar -A 1
 </pre>


<h3>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%ED%A1%BC%A5%C9%A5%A2%A5%D9%A5%EC%A1%BC%A5%B8">ロードアベレージ</a>を見る</h3>


<pre class="terminal"> :$ uptime
 </pre>


<pre class="terminal"> :$ sar -q 1
 </pre>


<pre class="terminal"> :$ top
 </pre>


<h3>CPU使用率を見る</h3>


<h4>topコマンドでCPU使用率を見る</h4>


<pre class="terminal"> :$ top
 </pre>


<p>※top実行中にshift m : メモリ使用率順にソート
※top実行中にshift p : CPU使用率順にソート
※top実行中にshift t : 実行時間順にソート
※top実行中にshift h : スレッド表示
※top実行中に 1 : コア数表示</p>

<p>実行されているコマンドの内容をフルパスで出力させる。</p>

<pre class="terminal"> :$ top -c (-d1)
 </pre>


<p>バッチモードで実行させる。</p>

<pre class="terminal"> :$ top -b
 </pre>


<h4>mpstatコマンドでCPU使用率を見る</h4>


<pre class="terminal"> :$ mpstat -P ALL 1
 </pre>


<h4>vmstatコマンドでCPU使用率を見る</h4>


<pre class="terminal"> :$ vmstat 1
 </pre>


<h4>pidstatコマンドでCPU使用率を見る</h4>


<pre class="terminal"> :$ pidstat 1
 </pre>


<pre class="terminal"> :$ pidstat -p [pid]
 </pre>


<pre class="terminal"> :$ pidstat -C [process name]
 </pre>


<h4>dstatコマンドでCPU使用率を見る</h4>


<p><code>-t</code>で時刻表示、<code>-a</code>ですべてのデータを報告。
<code>--top-cpu</code>でプロセスが私用しているCPU使用率の統計を報告。</p>

<pre class="terminal"> :$ dstat -ta --top-cpu
 </pre>


<p>コア単位の使用率を見る場合。</p>

<pre class="terminal"> :$ dstat -C 0,1
 </pre>


<p>コア単位+全CPUの使用率を見る場合。</p>

<pre class="terminal"> :$ dstat -C 0,1,total
 </pre>


<p>sarでCPU使用率を見る。</p>

<pre class="terminal"> :$ sar -P ALL 1
 </pre>


<h3>メモリ使用状況を見る</h3>


<h4>freeコマンドでメモリ使用率を見る</h4>


<pre class="terminal"> :$ free -m
 </pre>


<h4>vmstatコマンドでメモリ使用率を見る</h4>


<pre class="terminal"> :$ vmstat 1
 </pre>


<pre class="terminal"> :$ sar -r 1
 </pre>


<pre class="terminal"> :$ sar -R 1
 </pre>


<h4>/proc/meminfoの中身を探ってメモリ使用率を見る</h4>


<pre class="terminal"> :$ grep -E 'Active:|Slab:|VmallocUsed:|PageTables:|KernelStack:' /proc/meminfo |  awk '{a+=$2} END{print a;}'
 </pre>


<h3>IOの状態を見る</h3>


<h4>vmstatコマンドでIOの状態を見る</h4>


<pre class="terminal"> :$ vmstat -d 1
 </pre>


<h4>pidstatコマンドでIOの状態を見る</h4>


<pre class="terminal"> :$ pidstat -d
 </pre>


<h4>iostatコマンドでIOの状態を見る</h4>


<pre class="terminal"> :$ iostat -tx 1
 </pre>


<pre class="terminal"> :$ iostat -txz 1
 </pre>


<h4>dstatコマンドでIOの状態を見る</h4>


<p>※<code>--top-io-adv</code>, <code>--top-bio-adv</code>オプションはVersion 7.2.0以降から。</p>

<pre class="terminal"> :$ dstat -ta --top-io-adv --top-bio-adv
 </pre>


<h4>sarコマンド(sysstat)でIOの状態を見る</h4>


<p>IOPS等の状態を全体的に見る。</p>

<pre class="terminal"> :$ sar -b 1
 </pre>


<p>デ<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D0%A5%A4%A5%B9">バイス</a>単位でIOPS等の状態を見る。</p>

<pre class="terminal"> :$ sar -d 1
:$ sar -d -p 1
 </pre>


<h3>Networkの状態を見る</h3>


<h4>ssコマンドでIOの状態を見る</h4>


<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/TCP">TCP</a>のLISTENポートを見る。</p>

<pre class="terminal"> :$ ss -lnt
 </pre>


<pre class="terminal"> :$ sudo ss -anpto
 </pre>


<h4>dstatコマンドでネットワークの使用状態を見る</h4>


<pre class="terminal"> :$ dstat -n -N [nic device]
 </pre>


<h4>sarコマンドでネットワークの使用状態を見る</h4>


<pre class="terminal"> $ sar -n DEV 1
 </pre>


<h3>ストレージの情報を見る</h3>


<pre class="terminal"> :$ df -h
 </pre>


<pre class="terminal"> :$ df -i
 </pre>


<pre class="terminal"> :$ df -hTi
 </pre>


<h3>実行されているプロセスの情報を見る</h3>


<pre class="terminal"> :$ ps auxfwww
 </pre>


<pre class="terminal"> :$ ps -ef
 </pre>


<pre class="terminal"> :$ ps auxwww -L
 </pre>


<pre class="terminal"> :$ sudo lsof -p [pid]
 </pre>


<h3>システムログを見る</h3>


<pre class="terminal"> :$ sudo less /var/log/message
 </pre>


<pre class="terminal"> :$ sudo less /var/log/syslog
 </pre>


<p>エラー系メッセージのみ抽出する場合</p>

<pre class="terminal"> :$ sudo grep -iE 'warn|err|crit|fatal|emerg|alert' /var/log/message
 </pre>


<pre class="terminal"> :$ sudo grep -iE 'warn|err|crit|fatal|emerg|alert' /var/log/syslog
 </pre>


<h3>参考</h3>


<ul>
    <li><a target="_brank" rel="noopener noreferrer" href="https://blog.yuuk.io/entry/linux-server-operations">Linuxサーバにログインしたらいつもやっているオペレーション</a></li>
    <li><a target="_brank" rel="noopener noreferrer" href="http://techblog.netflix.com/2015/11/linux-performance-analysis-in-60s.html">The Netflix Tech Blog: Linux Performance Analysis in 60,000 Milliseconds</a></li>
</ul>

</body>
