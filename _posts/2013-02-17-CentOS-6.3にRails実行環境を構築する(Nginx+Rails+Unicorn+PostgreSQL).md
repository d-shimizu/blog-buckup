---
layout: post
Categories:  ["tech"]
Description:  " はじめに  さくらのVPSのCentOS 6.3環境にRails実行環境を構築してみましたのでその手順まとめです。   Railsの実行環境は、production(本番運用環境)、test(本番環境と同等テスト実行環境)、develop"
Tags: ["CentOS", "Rails", "さくらのVPS", "Unicorn", "Nginx", "環境構築"]
date: "2013-02-17T23:14:00+09:00"
title: "CentOS 6.3にRails実行環境を構築する(Nginx+Rails+Unicorn+PostgreSQL)"
author: "dshimizu"
archive: ["2013"]
draft: "true"
---

<body>
<h4>はじめに</h4>
<p>さくらの<a class="keyword" href="http://d.hatena.ne.jp/keyword/VPS">VPS</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a> 6.3環境に<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>実行環境を構築してみましたのでその手順まとめです。 </p>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>の実行環境は、production(本番運用環境)、test(本番環境と同等テスト実行環境)、development(開発環境)の3つがあります。一般的にproducution環境は<a class="keyword" href="http://d.hatena.ne.jp/keyword/Apache">Apache</a>やNginxなどのWebサーバと連携して利用し、development環境は<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>に付属されている<a class="keyword" href="http://d.hatena.ne.jp/keyword/WEBrick">WEBrick</a>というWebサーバを使ってローカル環境で動作確認するために使うことが良さそうですが、ここではNginx,<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a>も含めた開発環境のテスト構築のため、development環境のみにて環境構築をしています。<br></p>
<a name="more"></a><p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>は<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>で記述されたWebアプリケーション<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D5%A5%EC%A1%BC%A5%E0%A5%EF%A1%BC%A5%AF">フレームワーク</a>です。<a class="keyword" href="http://d.hatena.ne.jp/keyword/MVC">MVC</a>(Model/View/Controller)<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A2%A1%BC%A5%AD%A5%C6%A5%AF%A5%C1%A5%E3">アーキテクチャ</a>に基づいて構築します。<br><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>における<a class="keyword" href="http://d.hatena.ne.jp/keyword/MVC">MVC</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A2%A1%BC%A5%AD%A5%C6%A5%AF%A5%C1%A5%E3">アーキテクチャ</a>の概要については以下等が参考になるかと思います。 </p>
<ul>  <li><a href="http://www.atmarkit.co.jp/ait/articles/1102/23/news109.html">MVCとRailsの基本構成を学ぼう (1/3)</a></li>
</ul>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーションを利用する上でRack対応httpサーバに何を選択するかは重要かと思いますが、ここではhttpサーバに最近主流になりつつある<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a>を選択しています。 </p>
<ul>  <li><a href="http://unicorn.bogomips.org/">Unicorn: Rack HTTP server for fast clients and Unix</a></li>  <li><a href="http://rack.github.com/">Rack: a Ruby Webserver Interface</a></li>
</ul>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a>単体でも<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>を動作させることができますが、一般的にはWebサーバとなるソフトウェア(<a class="keyword" href="http://d.hatena.ne.jp/keyword/Apache">Apache</a>/Nignx等)をリバースプロキシとして利用して画像などの静的ファイルを処理させ、アプリケーションへのアクセスは<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a>へ渡し、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>での処理を行うのが一般的です。<br>Nignxと<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a>間の通信は<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unix">Unix</a> Domai Socketか<a class="keyword" href="http://d.hatena.ne.jp/keyword/TCP">TCP</a>が用いることができますが、ここでは<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unix">Unix</a> Domai Socketを利用することにしています。 <br></p>
<div align="center"><a href="http://3.bp.blogspot.com/-Y1cG0BR7QHE/UXYNX5KE5uI/AAAAAAAAATE/QgGEJa5Pnao/s1600/unicorn_architecture.png" imageanchor="1"><img border="0" src="http://3.bp.blogspot.com/-Y1cG0BR7QHE/UXYNX5KE5uI/AAAAAAAAATE/QgGEJa5Pnao/s600/unicorn_architecture.png"></a></div>
<br><p>なお、データベースには<a class="keyword" href="http://d.hatena.ne.jp/keyword/SQLite">SQLite</a>、<a class="keyword" href="http://d.hatena.ne.jp/keyword/MySQL">MySQL</a>、<a class="keyword" href="http://d.hatena.ne.jp/keyword/PostgreSQL">PostgreSQL</a>を選択することが可能で、デフォルトでは<a class="keyword" href="http://d.hatena.ne.jp/keyword/SQLite">SQLite</a>が選択されますが、ここではデータベースには<a class="keyword" href="http://d.hatena.ne.jp/keyword/PostgreSQL">PostgreSQL</a>を利用します。<br>Nginxと<a class="keyword" href="http://d.hatena.ne.jp/keyword/PostgreSQL">PostgreSQL</a>は<a class="keyword" href="http://d.hatena.ne.jp/keyword/RPM">RPM</a>パッケージでインストールされているものとします。<br>また、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>はrbenv+<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>-buildでインストールされているものとします。 </p> <h4>環境</h4>
<p>インストール環境は以下です。 </p>
<h5>プラットフォーム</h5>
<table>  <tr>    <td bgcolor="#cccccc">プラットフォーム</td>    <td>さくらの<a class="keyword" href="http://d.hatena.ne.jp/keyword/VPS">VPS</a>(<a class="keyword" href="http://d.hatena.ne.jp/keyword/SSD">SSD</a> 1Gモデル)</td>  </tr> <tr>    <td bgcolor="#cccccc">OS</td>    <td>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a> 6.3 (<a class="keyword" href="http://d.hatena.ne.jp/keyword/x86">x86</a>_64)</td>  </tr>
</table> <h5>利用するソフトウェア類</h5>
<table> <tr bgcolor="#cccccc">  <th><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DF%A5%C9%A5%EB%A5%A6%A5%A7%A5%A2">ミドルウェア</a></th>  <th>バージョン</th>  <th>備考</th>
</tr>
<tr> </tr>  <td><a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a></td>  <td>4.5.0</td>  <td>httpサーバ</td>
<tr>  <td>Nginx</td>  <td>1.2.6</td>  <td>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/CSS">CSS</a>,JS,画像ファイル処理用リバースプロキシ(<a class="keyword" href="http://d.hatena.ne.jp/keyword/RPM">RPM</a>インストール)</td>
</tr>
<tr>  <td><a class="keyword" href="http://d.hatena.ne.jp/keyword/PostgreSQL">PostgreSQL</a></td>  <td>9.2.1</td>  <td>DBサーバ(<a class="keyword" href="http://d.hatena.ne.jp/keyword/RPM">RPM</a>インストール)</td> </tr>
<tr>  <td><a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a></td>  <td>1.9.3-p374</td>  <td>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D7%A5%ED%A5%B0%A5%E9%A5%DF%A5%F3%A5%B0%B8%C0%B8%EC">プログラミング言語</a>(rbenv管理)</td> </tr>
<tr>  <td><a class="keyword" href="http://d.hatena.ne.jp/keyword/RubyGems">RubyGems</a></td>  <td>1.8.23</td>  <td>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のパッケージ/ライブラリ管理ツール</td> </tr>
<tr>  <td><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a></td>  <td>3.2.11</td>  <td>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby%20on%20Rails">Ruby on Rails</a> <a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D5%A5%EC%A1%BC%A5%E0%A5%EF%A1%BC%A5%AF">フレームワーク</a>
</td> </tr>
</table> <h5>その他環境補足情報</h5>
<table>
<tr>    <td bgcolor="#cccccc">
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーション用ルート<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リ</td>    <td>/home/railsapp</td>
</tr>
<tr>    <td bgcolor="#cccccc">Nginx待ち受けIP:ポート</td>    <td>0.0.0.0:80</td>
</tr>
<tr>    <td bgcolor="#cccccc">Nginxログ出力先<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リ</td>    <td>/var/log/nginx</td>
</tr>
<tr>    <td bgcolor="#cccccc">
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a>(<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>)待ち受けIP:ポート</td>    <td>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/127.0.0.1">127.0.0.1</a>:13000</td>
</tr>
<tr>    <td bgcolor="#cccccc">
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a>(<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>) <a class="keyword" href="http://d.hatena.ne.jp/keyword/Unix">Unix</a> Domain Socket</td>    <td>/var/run/<a class="keyword" href="http://d.hatena.ne.jp/keyword/unicorn">unicorn</a>/<a class="keyword" href="http://d.hatena.ne.jp/keyword/unicorn">unicorn</a>_railsapp.sock</td>
</tr>
<tr>    <td bgcolor="#cccccc">
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a>ログファイル出力先<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リ</td>    <td>/var/log/<a class="keyword" href="http://d.hatena.ne.jp/keyword/unicorn">unicorn</a>
</td>
</tr>
<tr>    <td bgcolor="#cccccc">
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a> Pidファイル作成先<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リ</td>    <td>/var/run/<a class="keyword" href="http://d.hatena.ne.jp/keyword/unicorn">unicorn</a>
</td>
</tr>
</table> <h4>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>実行環境構築</h4> <h5>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>のインストール</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>をインストールします。<br>インストールはrootで行います。 </p>
<pre class="terminal">  $ su - パスワード:  
</pre>
<p>最初にgemを最新化します。 </p>
<pre class="terminal">  # gem update  
</pre>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>をインストールします。 </p>
<pre class="terminal">  # gem install rails  
</pre>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%B4%C4%B6%AD%CA%D1%BF%F4">環境変数</a>($PATH)の再読み込みします。 </p>
<pre class="terminal">  # source ~/.bashrc  
</pre>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>がインストールされていることを確認します。 </p>
<pre class="terminal">  # which rails /usr/local/src/rbenv/shims/rails  
</pre>
<h6>bundlerのインストール</h6>
<p>bundlerという<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーション毎にgemパッケージ/ライブラリを独立して管理するためのツールをインストールします。 </p>
<pre class="terminal">  # gem install bundler  </pre>以上で<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>のインストールと設定は完了です。 <pre class="terminal">  # exit  </pre> <h5>新規<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーション作成と初期設定</h5>
<p>テスト用にrailsappという名前の<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーションを作成します。<br>-dオプションでデータベースに<a class="keyword" href="http://d.hatena.ne.jp/keyword/PostgreSQL">PostgreSQL</a>を指定します。--with-pg-configオプションにはpg_configのPATHを指定します。<a class="keyword" href="http://d.hatena.ne.jp/keyword/PostgreSQL">PostgreSQL</a> 9.2の<a class="keyword" href="http://d.hatena.ne.jp/keyword/RPM">RPM</a>パッケージでインストールした場合は/usr/pgsql-9.2/bin/pg_configとなっていると思います。<br>また、新規<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーション作成(<a class="keyword" href="http://d.hatena.ne.jp/keyword/rails">rails</a> new実行)時、Gemfileに基づいたgemパッケージ/ライブラリ類のインストール(bundle install)が自動で実行されますが、Gemfileは後に編集するため、最初は--skip-bundleのオプションを指定して、bundle installを実行しないようにします。 </p>
<pre class="terminal">  $ cd /home  
</pre>
<pre class="terminal">  $ rails new railsapp -d postgresql --with-pg-config=/usr/pgsql-9.2/bin/pg_config --skip-bundle  
</pre>
<p>database.ymlを編集し、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>からのデータベースへの接続情報(ユーザ名,パスワード)を設定します。 </p>
<pre class="terminal">  $ cd /home/railsapp/config  
</pre>
<pre class="terminal">  $ vim database.yml ### 以下を修正 development:   adapter: postgresql   encoding: unicode   database: railsapp_development   pool: 5   username: rails                 #Railsアプリ接続用のPostgreSQLユーザを設定   password: rails                 #Railsアプリ接続用のPostgreSQLパスワードを設定  
</pre>
<p>Gemfile内に必要なgemパッケージ/ライブラリを追記します。 </p>
<pre class="terminal">  $ cd /home/railsapp  
</pre>
<pre class="terminal">  $ vim Gemfile … gem 'pg'            # PostgreSQL)のgemパッケージ  gem 'execjs'        # javascriptランタイムライブラリ gem 'therubyracer'  # javascriptランタイムライブラリ … gem 'haml-rails'    # hamlライブラリ … gem 'unicorn'       # Unicornライブラリ  …  
</pre>
<p>Gemfileを編集したらbundle installを実行し、Gemfileに記述されたパッケージ/ライブラリをインストールします。<br>このとき--pathオプションを指定することで、その<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーションの任意の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リ配下にgemパッケージ/ライブラリ類をインストールできます($<a class="keyword" href="http://d.hatena.ne.jp/keyword/RAILS">RAILS</a>_ROOT/vendor/bundler<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リにインストールするのが一般的です)。<br>これによりインストールしたgemパッケージ/ライブラリは、この<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーションのみで利用可能な状態となり、他の環境に影響を与えません。 </p>
<pre class="terminal">  $ cd /home/railsapp  
</pre>
<pre class="terminal">  % bundle install --path vendor/bundle  
</pre>
<p>これで<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーションの作成は完了です。 </p> <h5>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/PostgreSQL">PostgreSQL</a>の設定</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリで利用するためのデータベースを作成します。 まず、<a class="keyword" href="http://d.hatena.ne.jp/keyword/PostgreSQL">PostgreSQL</a>サーバにログインします。 </p>
<pre class="terminal">  $ psql -U postgres psql (9.2.2) "help" でヘルプを表示します.  postgres=#   
</pre>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>接続用のユーザを作成します。 </p>
<pre class="terminal">  # CREATE USER rails WITH PASSWORD '************' CREATEDB CREATEUSER; CREATE ROLE  
</pre>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>用のデータベースを作成します。 </p>
<pre class="terminal">  # CREATE DATABASE railsapp_development; CREATE DATABASE  </pre> <h5>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a>の設定</h5>
<p>config<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リ配下に<a class="keyword" href="http://d.hatena.ne.jp/keyword/unicorn">unicorn</a>.rbというファイルを作成し、以下のような内容を記載します。 </p>
<pre class="terminal">  $ cd /home/railsapp/config  
</pre>
<pre class="terminal">  $ vim unicorn.rb application = 'railsapp'  worker_processes 2 working_directory "/home/#{application}"  listen "/var/run/unicorn/unicorn_#{application}.sock"   # Unix Domain Socket  pid "/var/run/unicorn/unicorn_#{application}.pid"       # PIDファイル出力先   timeout 60   preload_app true  stdout_path "/var/log/unicorn/unicorn.stdout_#{application}.log"  # 標準出力ログ出力先 stderr_path "/var/log/unicorn/unicorn.stderr_#{application}.log"  # 標準エラー出力ログ出力先   GC.respond_to?(:copy_on_write_friendly=) and GC.copy_on_write_friendly = true   before_fork do |server, worker|   defined?(ActiveRecord::Base) and ActiveRecord::Base.connection.disconnect!    old_pid = "#{server.config[:pid]}.oldbin"     if old_pid != server.pid       begin         sig = (worker.nr + 1) &gt;= server.worker_processes ? :QUIT : :TTOU         Process.kill(sig, File.read(old_pid).to_i)       rescue Errno::ENOENT, Errno::ESRCH       end     end       sleep 1   end   after_fork do |server, worker|   defined?(ActiveRecord::Base) and ActiveRecord::Base.establish_connection end  
</pre>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a>ログファイルやPIDファイル用の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リを作成します。 </p>
<pre class="terminal">  $ su - パスワード:  
</pre>
<pre class="terminal">  # mkdir /var/log/unicorn  
</pre>
<pre class="terminal">  # chmod 777 /var/log/unicorn  
</pre>
<pre class="terminal">  # mkdir /var/run/unicorn  
</pre>
<pre class="terminal">  # chmod 777 /var/run/unicorn  </pre> <h5>Nginxの設定</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a>と連携するためのNginxの設定ファイルを作成します。 <br>デフォルトのnginx.confを編集したくないので、/etc/nginx/conf.d配下にnginxの設定ファイル(ここでは仮として<a class="keyword" href="http://d.hatena.ne.jp/keyword/rails">rails</a>.conf)を新規に作成します。<br>前述のとおり、バックエンドの<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a>との通信には<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unix">Unix</a> Domain Socketを利用します。<a class="keyword" href="http://d.hatena.ne.jp/keyword/TCP">TCP</a>通信を利用したい場合はproxy_passに<a class="keyword" href="http://d.hatena.ne.jp/keyword/TCP">TCP</a>のものを適用してください。 </p>
<pre class="terminal">  $ su - パスワード:  
</pre>
<pre class="terminal">  # cd /etc/nginx/conf.d  
</pre>
<pre class="terminal">  # vim rails.conf      ### バックエンドのUnicornとの通信にはUnix Domain SocketかTCPのいずれかを利用     ### ここではUnix Domain Socketを利用     upstream unicorn-unix-domain-socket {         ### unicorn.rbで指定したUnicornのソケットを指定:         server unix:/var/run/unicorn/unicorn_railsapp.sock fail_timeout=0;     }      upstream unicorn-tcp {         ### unicornのポートを指定 ※ここでは、Unicorn起動時にポート 13000で起動させるものとします。         server 127.0.0.1:13000;     }      server {         listen 80;         server_name xxxxx.sakura.ne.jp;          root /home/railsapp/public;          access_log  /var/log/nginx/access.log;         error_log /var/log/nginx/error.log;          location / {             if (-f $request_filename) {                 break;             }              proxy_set_header X-Real-IP  $remote_addr;             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;             proxy_set_header Host $http_host;              proxy_pass http://unicorn-unix-domain-socket;      # unix domain socketを使う場合             # proxy_pass http://unicorn-tcp;                   # tcpを使う場合          }           location ~* \.(ico|css|js|gif|jpe?g|png)(\?[0-9]+)?$ {             expires 1y;          }      }  
</pre>
<p>デフォルトの設定ファイルが読み込まれないようにリネームしておきます。 </p>
<pre class="terminal">  # mv default.conf _default.conf_  </pre>Nginxを再起動(起動)します。 <pre class="terminal">  # service nginx restart Stopping nginx:                                            [  OK  ] Starting nginx:                                            [  OK  ]  </pre> <h4>確認</h4> <h5>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a>の起動</h5>
<p>Nginxの設定ファイルに記述したとおりに、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a>を使って<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>をポート13000(-pオプション)を使ってデーモンモード(-Dオプション)としてバックグラウンドで起動させます。環境はdevelopment(-Eオプション)とします。 </p>
<pre class="terminal">  $ unicorn_rails -c /home/railsapp/config/unicorn.rb -E development -D -p 13000  
</pre>
<p>さくらの<a class="keyword" href="http://d.hatena.ne.jp/keyword/VPS">VPS</a>環境にブラウザからhttpでアクセスすると、以下のような画面が表示されると思います。 </p>
<p><a href="http://xxx.xxx.xxx.xxx">http://xxx.xxx.xxx.xxx</a>  # VPSのホストの<a class="keyword" href="http://d.hatena.ne.jp/keyword/IP%A5%A2%A5%C9%A5%EC%A5%B9">IPアドレス</a> </p>
<a href="http://3.bp.blogspot.com/-Ms1O1fKY0Bg/USC4QShwQyI/AAAAAAAAARs/h7de0XaWKAo/s1600/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88+2013-02-17+19.56.03.png" imageanchor="1"><img border="0" src="http://3.bp.blogspot.com/-Ms1O1fKY0Bg/USC4QShwQyI/AAAAAAAAARs/h7de0XaWKAo/s600/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88+2013-02-17+19.56.03.png"></a><p>"About your application’s environment"を押下して、以下のように<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>の環境情報が表示されればWebサーバやDBサーバとの連携が正常に行えていることになります。<br></p>
<a href="http://2.bp.blogspot.com/-0W6vTymSOQs/USC5J6s8EQI/AAAAAAAAAR0/PBQZtiBF9ms/s1600/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88+2013-02-17+19.57.15.png" imageanchor="1"><img border="0" src="https://cdn-ak.f.st-hatena.com/images/fotolife/d/dshimizu/20220322/20220322113636.png"></a> <h4>おわりに</h4>
<p>以上で、<a class="keyword" href="http://d.hatena.ne.jp/keyword/CentOS">CentOS</a> 6.3上でUnucornを使った<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>実行環境ができました。 <a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>と合わせて<a class="keyword" href="http://d.hatena.ne.jp/keyword/Unicorn">Unicorn</a>やNginxについても勉強しながらもっと環境整備をできればと思います。 あとは<a class="keyword" href="http://d.hatena.ne.jp/keyword/Capistrano">Capistrano</a>を使ってのデプロイ自動化も行っていきたいです。 </p> <iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?t=dshimizu05-22&amp;o=9&amp;p=8&amp;l=as1&amp;asins=4774165166&amp;ref=qf_sp_asin_til&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;m=amazon&amp;lc1=0000FF&amp;bc1=000000&amp;bg1=FFFFFF&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>
</body>

<!-- more -->


