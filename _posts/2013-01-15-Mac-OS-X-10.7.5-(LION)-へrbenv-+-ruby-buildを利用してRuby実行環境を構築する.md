---
layout: post
Categories:  ["tech"]
Description:  " はじめに  Webアプリ開発の勉強の目的で半年ほど前にMacBook Airを購入したままながらく放置していましたが、ようやく環境構築に取り組もうと思い立ち、Rubyのインストールを行いました。 勉強対象とする言語は特になんでも良かったの"
Tags: ["Ruby", "rbenv", "環境構築", "Mac"]
date: "2013-01-15T02:58:00+09:00"
title: "Mac OS X 10.7.5 (LION) へrbenv + ruby-buildを利用してRuby実行環境を構築する"
author: "dshimizu"
archive: ["2013"]
draft: "true"
---

<body>
<h4>はじめに</h4>
<p>Web<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A2%A5%D7%A5%EA%B3%AB%C8%AF">アプリ開発</a>の勉強の目的で半年ほど前に<a class="keyword" href="http://d.hatena.ne.jp/keyword/MacBook%20Air">MacBook Air</a>を購入したままながらく放置していましたが、ようやく環境構築に取り組もうと思い立ち、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のインストールを行いました。<br>勉強対象とする言語は特になんでも良かったのですが、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Twitter">Twitter</a>や<a class="keyword" href="http://d.hatena.ne.jp/keyword/github">github</a>、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Cookpad">Cookpad</a>など様々な<a class="keyword" href="http://d.hatena.ne.jp/keyword/Web%A5%B5%A1%BC%A5%D3%A5%B9">Webサービス</a>利用されている<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>の登場により人気が出てきている<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>を使ってみようと思った程度です。 </p>
<a name="more"></a><p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のインストールの方法はいくつかありますが、ここでは<a class="keyword" href="http://d.hatena.ne.jp/keyword/UNIX">UNIX</a>/<a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a>環境で複数の<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>を共存/切り替えを行うためのツールであるrbenvと、rbenvのみでは<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のバージョン切り替えのみしか行えないため、異なるバージョンを<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB">コンパイル</a>しインストールするためのrbenv<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D7%A5%E9%A5%B0%A5%A4%A5%F3">プラグイン</a>である<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>-buildを利用してインストールを行いました。 </p>
<ul>  <li><a href="https://github.com/sstephenson/rbenv">README.md - sstephenson / rbenv</a></li>  <li><a href="https://github.com/sstephenson/ruby-build">README.md - sstephenson / ruby-build</a></li>
</ul>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のバージョン管理ツールとしては多機能なRVMが主流なようですが、最近ではシンプルな機能を持つとされているrbenvのほうも人気が出てきているようですので、rbenvを使うことにしました。 <br>以下に、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Mac%20OS%20X">Mac OS X</a> 10.7.5(LION)でrbenvと<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>-buildを使っての<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>インストールの手順まとめましたので記載致します。  </p>
<h4>インストール環境</h4>
<p>インストール環境は以下です。 </p>
<table>  <tr>    <td bgcolor="#cccccc">プラットフォーム</td>    <td><a class="keyword" href="http://d.hatena.ne.jp/keyword/MacBook%20Air">MacBook Air</a></td>  </tr> <tr>    <td bgcolor="#cccccc">OS</td>    <td>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Mac%20OS%20X">Mac OS X</a> 10.7.5</td>  </tr> <tr>    <td bgcolor="#cccccc">rbenvインストール先</td>    <td>/usr/local/Cellar</td>  </tr> <tr>    <td bgcolor="#cccccc">
<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>-buildインストール先</td>    <td>/usr/local/Cellar</td>  </tr>
</table> <h4>事前準備</h4>
<p>rbenv,rbenv-build,<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>をインストールするための事前準備として<a class="keyword" href="http://d.hatena.ne.jp/keyword/Xcode">Xcode</a>,homebrewを導入しておく必要があります。 </p>
<ul>  <li>
<a href="https://developer.apple.com/xcode/">Command Line Tools for Xcode</a> (要<a class="keyword" href="http://d.hatena.ne.jp/keyword/Apple">Apple</a> ID)</li>  <li>
<a href="http://mxcl.github.com/homebrew/">homebrew</a> </li>
</ul>
<h5>Command Line Tools for <a class="keyword" href="http://d.hatena.ne.jp/keyword/Xcode">Xcode</a>のインストール</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Mac%20OS%20X">Mac OS X</a> 10.7.5(LION)に対応したCommand Line Tools for <a class="keyword" href="http://d.hatena.ne.jp/keyword/Xcode">Xcode</a>をダウンロードしてインストールします。 <br>Command Line Tools for <a class="keyword" href="http://d.hatena.ne.jp/keyword/Xcode">Xcode</a>インストール後には、以下のように<a class="keyword" href="http://d.hatena.ne.jp/keyword/llvm">llvm</a>-<a class="keyword" href="http://d.hatena.ne.jp/keyword/gcc">gcc</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%E9">コンパイラ</a>がインストールされていると思います。 </p>
<pre class="terminal">  % ls -l /usr/bin/gcc lrwxr-xr-x  1 root  wheel  12  7 28 18:37 /usr/bin/gcc -&gt; llvm-gcc-4.2  
</pre>
<pre class="terminal">  % which llvm-gcc-4.2 /usr/bin/llvm-gcc-4.2  
</pre>
<p>※後に少し記述しますが、<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby%201.9">ruby 1.9</a>.3p125以前のバージョン(Ruby1.8系含む)をインストールする場合は、純正の<a class="keyword" href="http://d.hatena.ne.jp/keyword/gcc">gcc</a>が必要になります。 </p>
<h5>homebrewのインストール</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Mac%20OS">Mac OS</a>用パッケージマネージャ(<a class="keyword" href="http://d.hatena.ne.jp/keyword/Mac%20OS%20X">Mac OS X</a>の環境(各種ライブラリ)などを利用し<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AA%A1%BC%A5%D7%A5%F3%A5%BD%A1%BC%A5%B9">オープンソース</a>ソフトなどをインストールするためのツール)であるhomebrewを以下の通りインストールします。<br>homebrewはrbenv他必要なパッケージのインストールに利用します。 </p>
<pre class="terminal">  % /usr/bin/ruby -e "$(/usr/bin/curl -fsSL https://raw.github.com/mxcl/homebrew/master/Library/Contributions/install_homebrew.rb)"  
</pre>
<pre class="terminal">  $ /usr/bin/ruby -e "$(curl -fsSL https://raw.github.com/mxcl/homebrew/go)"  
</pre>
<ul>  <li>【参考】homebrew インストール手順  <a href="https://github.com/mxcl/homebrew/wiki/installation">Installation - mxcl / homebrew</a>
</li>
</ul>
<p>インストールされていることを確認します。 </p>
<pre class="terminal">  % which brew /usr/local/bin/brew % brew -v  Homebrew 0.9.3  </pre> <h4>homebrewから必要なパッケージ類のインストール</h4>
<h5>rbenv, rbenv-buildのインストール</h5>
<p>公式手順通りにrbenv,<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>-buildをそれぞれインストールします。 </p>
<ul>  <li><a href="https://github.com/sstephenson/rbenv#homebrew-on-mac-os-x">Homebrew on Mac OS X - sstephenson / rbenv</a></li>  <li><a href="https://github.com/sstephenson/ruby-build#installing-with-homebrew-for-os-x-users">Installing with Homebrew (for OS X users) -  sstephenson / ruby-build</a></li>
</ul>
<pre class="terminal">  % brew install rbenv % brew install ruby-build  
</pre>
<p>.zshrcにrbenv用の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B4%C4%B6%AD%CA%D1%BF%F4">環境変数</a>を設定します。 </p>
<pre class="terminal">  % vim ~/.zshrc ### 環境変数等の設定追加 export PATH=$HOME/.rbenv/shims:$PATH eval "$(rbenv init -)"  
</pre>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%B4%C4%B6%AD%CA%D1%BF%F4">環境変数</a>を再読み込みします。 </p>
<pre class="terminal">  % source ~/.zshrc  
</pre>
<h5>その他ライブラリのインストール</h5>
<p>必要に応じてライブラリ類もインストールします。 </p>
<strong><u>opensslのインストール</u></strong><p>OpenSSLを<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>から扱うライブラリをインストールします。 </p>
<pre class="terminal">  $ brew install openssl $ brew link openssl  
</pre>
<strong><u>readlineのインストール</u></strong><p><a class="keyword" href="http://d.hatena.ne.jp/keyword/irb">irb</a>などで利用する<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%DE%A5%F3%A5%C9%A5%E9%A5%A4%A5%F3">コマンドライン</a>入力インタフェースを提供するモジュール"readline"をインストールします。 </p>
<pre class="terminal">  % brew install readline % brew link readline  </pre> <h4>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のインストールと設定</h4>
<h5>
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby%201.9">Ruby 1.9</a>.3のインストール</h5>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby%201.9">Ruby 1.9</a>.3をインストールします。<br>まず、以下コマンドでインストール可能な<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>ソースの一覧を確認します。 </p>
<pre class="terminal">  % rbenv install -l  
</pre>
<p>2013/01/15時点で最新の<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby%201.9">Ruby 1.9</a>.3-p362をインストールします。<br>明示的に<a class="keyword" href="http://d.hatena.ne.jp/keyword/LLVM">LLVM</a> <a class="keyword" href="http://d.hatena.ne.jp/keyword/GCC">GCC</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%E9">コンパイラ</a>を利用するように<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B4%C4%B6%AD%CA%D1%BF%F4">環境変数</a>を設定します。 </p>
<pre class="terminal">  % export CC=/usr/bin/gcc  
</pre>
<p>rbenvを使って<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby%201.9">Ruby 1.9</a>.3-p362を<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB">コンパイル</a>し、インストールします。<br>Configureオプションには、別途インストールしていたreadlineやopensslライブラリのインストール先PATHを指定しています。 </p>
<pre class="terminal">  % CONFIGURE_OPTS="--with-readline-dir=/usr/local --with-openssl-dir=/usr/local" rbenv install 1.9.3-p362  
</pre>
<p>インストールされた<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のバージョン一覧は"rbenv versions"で確認できます。<br>現状ではsystem(標準でインストールされている<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>)と1.9.3-p362がインストールされている状態ですので、それが表示されます。<br>現在設定されている<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のバージョンには"*"が付与されます。<br>(なお、"rbenv version"だと現在設定されている<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のバージョンが表示されます。) </p>
<pre class="terminal">  % rbenv versions * system   1.9.3-p362 (set by /Users/XXX(ユーザ名)/.rbenv/version)  
</pre>
<p><strong><u>※<a class="keyword" href="http://d.hatena.ne.jp/keyword/Xcode">Xcode</a>でインストールされる<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%E9">コンパイラ</a></u></strong></p>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Xcode">Xcode</a> 4.3から純正の<a class="keyword" href="http://d.hatena.ne.jp/keyword/gcc">gcc</a>が無くなり、<a class="keyword" href="http://d.hatena.ne.jp/keyword/llvm">llvm</a>-<a class="keyword" href="http://d.hatena.ne.jp/keyword/gcc">gcc</a>もしくはclang(どちらも<a class="keyword" href="http://d.hatena.ne.jp/keyword/LLVM">LLVM</a>利用)の2つしか<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%E9">コンパイラ</a>がないため、<a class="keyword" href="http://d.hatena.ne.jp/keyword/gcc">gcc</a>を利用してビルドする必要がある<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby%201.9">Ruby 1.9</a>.3p125以前のインストールができません。<br>以下のようにエラーとなります。<br>これらの<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>をインストールするには以下のメッセージの通り、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Xcode">Xcode</a> 4.2あるいは<a class="keyword" href="http://d.hatena.ne.jp/keyword/github">github</a>から自分で純正の<a class="keyword" href="http://d.hatena.ne.jp/keyword/gcc">gcc</a>をビルドして利用する必要があります。 </p>
<p></p>
<pre class="terminal">  % rbenv install 1.9.2-p320  ERROR: This package must be compiled with GCC, but ruby-build couldn't find a suitable `gcc` executable on your system. Please install GCC and try again.  DETAILS: Apple no longer includes the official GCC compiler with Xcode as of version 4.2. Instead, the `gcc` executable is a symlink to `llvm-gcc`, a modified version of GCC which outputs LLVM bytecode.  For most programs the `llvm-gcc` compiler works fine. However, versions of Ruby older than 1.9.3-p125 are incompatible with `llvm-gcc`. To build older versions of Ruby you must have the official GCC compiler installed on your system.  TO FIX THE PROBLEM: Install the official GCC compiler using these packages: https://github.com/kennethreitz/osx-gcc-installer/downloads  You will need to install the official GCC compiler to build older versions of Ruby even if you have installed Apple's Command Line Tools for Xcode package. The Command Line Tools for Xcode package only includes `llvm-gcc`.  BUILD FAILED  
</pre>
<h5>利用する<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のバージョン切り替え</h5>
<p>現時点では<a class="keyword" href="http://d.hatena.ne.jp/keyword/Mac%20OS%20X">Mac OS X</a>で標準インストールされている<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>を利用するように設定されています。 </p>
<pre class="terminal">  % rbenv version system (set by /Users/XXX(ユーザ名)/.rbenv/version) % ruby -v ruby 1.8.7 (2012-02-08 patchlevel 358) [universal-darwin11.0]  
</pre>
<p>rbenvで新しくインストールした<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>を利用するように変更します。 </p>
<p><strong><u>・システム全体で使用する<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のバージョンを指定する</u></strong></p>
<p>システム全体で使用する<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のバージョンを指定するには"rbenv global"を実行します。 </p>
<pre class="terminal">  % rbenv global 1.9.3-p362  
</pre>
<p>rbenv rehashを実行します。<br>これにより、$HOME/.shims<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リ配下に<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>やgemでインストールしたツールを起動するための実行ファイルが作成されます。 </p>
<pre class="terminal">  % rbenv rehash  
</pre>
<p>利用する<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のバージョンが変更されていることが確認できます。 </p>
<pre class="terminal">  % rbenv version 1.9.3-p362 (set by /Users/XXX(ユーザ名)/.rbenv/version)  
</pre>
<pre class="terminal">  % ruby -v      ruby 1.9.3p362 (2012-12-25 revision 38607) [x86_64-darwin11.4.2]  
</pre>
<br><p><strong><u>・システム全体で使用する<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のバージョンをOS標準の<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>に戻す</u></strong></p>
<p>標準でインストールされている<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>に戻す手順は以下の通りです。 </p>
<p></p>
<pre class="terminal">  % rbenv global system % rbenv rehash ruby -v ruby 1.8.7 (2012-02-08 patchlevel 358) [universal-darwin11.0]  
</pre>
<h4>おわりに</h4>
<p>以上で、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Mac%20OS%20X">Mac OS X</a> 10.7.5(LION)でrbenvと<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>-buildを使って<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby%201.9">Ruby 1.9</a>.3の最新版をインストールすることができました。<br>次は<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby%20on%20Rails">Ruby on Rails</a>の環境構築を行ってみようと思います。 </p>
<p></p>
<h4>参考</h4>
<p>RVMとrbenvの違いは以下にいろいろとまとめられており、参考にさせていただきました。 </p>
<ul>
<li><a href="https://github.com/sstephenson/rbenv#readme">README.md - sstephenson / rbenv</a></li>
<li><a href="http://qa.atmarkit.co.jp/q/2">rbenvとRVMの違いは？ - QA@IT</a></li>
<li><a href="http://blog.happyelements.co.jp/2012/10/rbenv.html">モテカワるびいすとのための rbenv 入門 - Happy Elements Labs</a></li>
<li><a href="http://passingloop.tumblr.com"> passingloop • rbenv と RVM との違い</a></li>
</ul>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のインストールは以下の記事を参考にさせていただきました。</p>
<ul>
<li><a href="http://qiita.com/items/9dd797f42e7bea674705">OS X で rbenv を使って ruby 1.9.3 の環境を作る </a></li>
<li><a href="http://pplog.org/?p=1845">【初心者向け】Mac(OSX Lion)でRuby on Railsを動かすための5ステップ</a></li>
<li><a href="http://wp.me/p1Hd3P-4Z">Homebrew ＋ Command Line Tools for Xcode ＋ rbenv 環境構築</a></li>
<li><a href="http://qiita.com/items/8e973a544b592376a07e">rbenvを使ってシステムワイドにrubyをインストールする方法</a></li>
</ul>  <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/LLVM">LLVM</a>については以下の記事がわかりやすかったと思います。</p>
<ul><li><a href="http://blog.fenrir-inc.com/jp/2011/07/llvm.html">Xcode 4 でデフォルトになった LLVM って何?</a></li></ul>
</body>

<!-- more -->


