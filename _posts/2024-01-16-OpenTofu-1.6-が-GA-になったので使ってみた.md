---
title: "OpenTofu 1.6 が GA になったので使ってみた"
date: 2024-01-16
slug: "OpenTofu 1.6 が GA になったので使ってみた"
category: blog
tags: [OpenTofu,Tech]
---
<h2 id="はじめに">はじめに</h2>

<p><a class="keyword" href="https://d.hatena.ne.jp/keyword/Linux">Linux</a> Foundation のプロジェクトの1つである OpenTofu が、2024年1月10日に「OpenTofu 1.6.0」をリリースしました。2023年9月にTerraformからフォークしてから約4ヵ月でのリリースとなります。</p>

<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fwww.linuxfoundation.org%2Fpress%2Fopentofu-announces-general-availability" title="OpenTofu Announces General Availability" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;" loading="lazy"></iframe><cite class="hatena-citation"><a href="https://www.linuxfoundation.org/press/opentofu-announces-general-availability">www.linuxfoundation.org</a></cite></p>

<p>OpenTofu をインストールして、個人で使っている Terraform を OpenTofu へ置き換えてみました。</p>

<h2 id="Terraform-と-OpenTofu-の違いとか">Terraform と OpenTofu の違いとか</h2>

<h3 id="機能面の違い">機能面の違い</h3>

<p>FAQ に記載がありました。</p>

<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fopentofu.org%2Ffaq%23opentofu-compatibility" title="FAQ | OpenTofu" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;" loading="lazy"></iframe><cite class="hatena-citation"><a href="https://opentofu.org/faq#opentofu-compatibility">opentofu.org</a></cite></p>

<p>掻い摘んで記載すると以下のようなことが書かれているようでした。</p>

<ul>
<li>OpenTofu 1.6 と Terraform 1.6 は機能の差はほぼない。ただ、将来的には機能上の差が出てくる。現状では、OpenTofuを導入するためのTerraformとの学習コストのギャップが少ない。</li>
<li>OpenTofu は大規模なコミュニティであるため、問題の解決も速くなる</li>
<li>急なライセンス変更となるリスクが低い</li>
</ul>


<p>...など。</p>

<h3 id="コード面の違い">コード面の違い</h3>

<p>OpentTofu v1.6.0 と Terraform v1.6.6 でのコード上の違いは全然見れてませんが、<a class="keyword" href="https://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リ構造は変わってました。
また Terraform 等の文字を含むコメントやメッセージ出力も OpenTofu のものに変わっているようでした。</p>

<ul>
<li><a href="https://github.com/opentofu/opentofu/tree/v1.6.0">GitHub - opentofu/opentofu at v1.6.0</a></li>
<li><a href="https://github.com/hashicorp/terraform/tree/v1.6.6">GitHub - hashicorp/terraform at v1.6.6</a></li>
</ul>


<p>コマンド体系は <code>terraform</code> コマンドから <code>tofu</code> コマンドに変わった以外は違いはなさそうです。</p>

<h2 id="OpenTofuセットアップ">OpenTofuセットアップ</h2>

<p>公式ドキュメントに沿ってインストールします。</p>

<ul>
<li><a href="https://opentofu.org/docs/intro/install/deb">Installing OpenTofu on .deb-based Linux (Debian, Ubuntu, etc.) | OpenTofu</a></li>
</ul>


<h3 id="環境">環境</h3>

<p>環境は下記で、<a class="keyword" href="https://d.hatena.ne.jp/keyword/Debian">Debian</a> 12 になります。</p>

<pre class="code lang-zsh" data-lang="zsh" data-unlink>% uname -srvmpio
Linux <span class="synConstant">6.1</span>.0-12-cloud-amd64<span class="synComment"> #1 SMP PREEMPT_DYNAMIC Debian 6.1.52-1 (2023-09-07) x86_64 unknown unknown GNU/Linux</span>
</pre>


<p>Terraform は v1.6.6 になります。</p>

<pre class="code lang-zsh" data-lang="zsh" data-unlink>% terraform -v
Terraform v<span class="synConstant">1.6</span>.<span class="synConstant">6</span>
on linux_amd64
</pre>


<h3 id="インストール">インストール</h3>

<p>ドキュメントにある通りインストール<a class="keyword" href="https://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8">スクリプト</a>が公開されているのでこれを取得します。</p>

<pre class="code lang-zsh" data-lang="zsh" data-unlink>% curl --proto <span class="synConstant">'=https'</span> --tlsv<span class="synConstant">1.2</span> -fsSL https://get.opentofu.org/install-opentofu.sh -o install-opentofu.sh
</pre>


<p>実行します。</p>

<pre class="code lang-zsh" data-lang="zsh" data-unlink>% ./install-opentofu.sh --install-method deb
</pre>


<p>問題なくインストールされました。</p>

<pre class="code lang-zsh" data-lang="zsh" data-unlink>% <span class="synStatement">which</span> tofu
/usr/bin/tofu
</pre>


<p>バージョンは 1.6.0 です。</p>

<pre class="code lang-zsh" data-lang="zsh" data-unlink>% tofu -v
OpenTofu v<span class="synConstant">1.6</span>.<span class="synConstant">0</span>
on linux_amd64
</pre>


<p>help をみてみます。コマンド体系はほぼ Terraform と同じように思いました。</p>

<pre class="code lang-zsh" data-lang="zsh" data-unlink>% tofu -help
Usage: tofu [global options] <span class="synStatement">&lt;</span>subcommand<span class="synStatement">&gt;</span> [args]

The available commands <span class="synStatement">for</span> execution are listed below.
The primary workflow commands are given first, followed by
less common or more advanced commands.

Main commands:
  init          Prepare your working directory <span class="synStatement">for</span> other commands
  validate      Check whether the configuration is valid
  plan          Show changes required by the current configuration
  apply         Create or update infrastructure
  destroy       Destroy previously-created infrastructure

All other commands:
  console       Try OpenTofu expressions at an interactive <span class="synSpecial">command</span> prompt
  fmt           Reformat your configuration <span class="synStatement">in</span> the standard style
  force-unlock  Release a stuck lock on the current workspace
  get           Install or upgrade remote OpenTofu modules
  graph         Generate a Graphviz graph of the steps <span class="synStatement">in</span> an operation
  import        Associate existing infrastructure with a OpenTofu resource
  login         Obtain and save credentials <span class="synStatement">for</span> a remote host
  <span class="synStatement">logout</span>        Remove locally-stored credentials <span class="synStatement">for</span> a remote host
  metadata      Metadata related commands
  output        Show output values from your root module
  providers     Show the providers required <span class="synStatement">for</span> this configuration
  refresh       Update the state to match remote systems
  show          Show the current state or a saved plan
  state         Advanced state management
  taint         Mark a resource instance as not fully functional
  <span class="synStatement">test</span>          Execute integration tests <span class="synStatement">for</span> OpenTofu modules
  untaint       Remove the <span class="synConstant">'tainted'</span> state from a resource instance
  version       Show the current OpenTofu version
  workspace     Workspace management

Global options (use these before the subcommand, <span class="synStatement">if</span> any):
  -chdir=DIR    Switch to a different working directory before executing the
                given subcommand.
  -help         Show this help output, or the help <span class="synStatement">for</span> a specified subcommand.
  -version      An <span class="synStatement">alias</span> <span class="synStatement">for</span> the <span class="synConstant">&quot;version&quot;</span> subcommand.
</pre>


<h2 id="Terraform-からの移行">Terraform からの移行</h2>

<p>Terraform からの移行についてもドキュメントが公開されていました。</p>

<ul>
<li><a href="https://opentofu.org/docs/intro/migration">Migrating to OpenTofu from Terraform | OpenTofu</a></li>
</ul>


<p>上述の通り、Terraform v1.6.6 を使っています。</p>

<p>tofu コマンドを実行してみたところ、以下のようなエラーになりました。
※手元の環境ではスイッチロールを実行しているため sandbox という名称の <code>AWS_PROFILE</code> を設定しています。</p>

<pre class="code lang-zsh" data-lang="zsh" data-unlink>% AWS_PROFILE=sandbox tofu plan
╷
│ Error: Inconsistent dependency lock file
│
│ The following dependency selections recorded <span class="synStatement">in</span> the lock file are inconsistent with the current configuration:
│   <span class="synSpecial">-</span> provider registry.opentofu.org/hashicorp/aws: required by this configuration but no version is selected
│
│ To update the locked dependency selections to match a changed configuration, run:
│   tofu init -upgrade
╵
</pre>


<p>出力にある通り、 <code>tofu init -upgrade</code> を実行してみます。</p>

<pre class="code lang-zsh" data-lang="zsh" data-unlink>% AWS_PROFILE=sandbox tofu init -upgrade

Initializing the backend...
Upgrading modules...
<span class="synSpecial">-</span> hoge-module <span class="synStatement">in</span> ../../modules/hoge

Initializing provider plugins...
<span class="synSpecial">-</span> terraform.io/<span class="synSpecial">builtin</span>/terraform is built <span class="synStatement">in</span> to OpenTofu
<span class="synSpecial">-</span> Finding hashicorp/aws versions matching <span class="synConstant">&quot;~&gt; 5.0&quot;</span>...
<span class="synSpecial">-</span> Installing hashicorp/aws v<span class="synConstant">5.32</span>.<span class="synConstant">1</span>...
<span class="synSpecial">-</span> Installed hashicorp/aws v<span class="synConstant">5.32</span>.<span class="synConstant">1</span> (signed, key ID 0C0AF313E5FD9F80)

Providers are signed by their developers.
If you<span class="synConstant">'d like to know more about provider signing, you can read about it here:</span>
<span class="synConstant">https://opentofu.org/docs/cli/plugins/signing/</span>

<span class="synConstant">OpenTofu has made some changes to the provider dependency selections recorded</span>
<span class="synConstant">in the .terraform.lock.hcl file. Review those changes and commit them to your</span>
<span class="synConstant">version control system if they represent changes you intended to make.</span>

<span class="synConstant">OpenTofu has been successfully initialized!</span>

<span class="synConstant">You may now begin working with OpenTofu. Try running &quot;tofu plan&quot; to see</span>
<span class="synConstant">any changes that are required for your infrastructure. All OpenTofu commands</span>
<span class="synConstant">should now work.</span>

<span class="synConstant">If you ever set or change modules or backend configuration for OpenTofu,</span>
<span class="synConstant">rerun this command to reinitialize your working directory. If you forget, other</span>
<span class="synConstant">commands will detect it and remind you to do so if necessary.</span>
</pre>


<p>正常終了したようです。</p>

<p>改めて <code>tofu plan</code> を実行してみます。</p>

<pre class="code lang-zsh" data-lang="zsh" data-unlink>% AWS_PROFILE=sandbox tofu plan
  :
  :

No changes. Your infrastructure matches the configuration.

OpenTofu has compared your real infrastructure against your configuration and found no differences, so no changes are needed.
</pre>


<p>正常終了しました。
変更箇所はないのですが、<code>tofu apply</code> を実行してみます。</p>

<pre class="code lang-zsh" data-lang="zsh" data-unlink>% AWS_PROFILE=sandbox tofu apply
  :
  :

No changes. Your infrastructure matches the configuration.

OpenTofu has compared your real infrastructure against your configuration and found no differences, so no changes are needed.

Apply complete! Resources: <span class="synConstant">0</span> added, <span class="synConstant">0</span> changed, <span class="synConstant">0</span> destroyed.
</pre>


<p>正常終了しました。</p>

<p>とりあえず大丈夫そうです。</p>

<h2 id="まとめ">まとめ</h2>

<p>OpenTofu 1.6 が GA になったのでインストールして少し使ってみました。
現時点では、Terraform をユーザーとして(terraformを使ってシステムを構築するような用途で)利用している場合はライセンスによる影響はないと思いますので、プロダクション用途で使っているTerraformを置き換える必要はないのではと思いました。
とりあえず個人利用でしばらく触ってみようかと思います。</p>

<h2 id="参考">参考</h2>

<ul>
<li><a href="https://www.linuxfoundation.org/press/opentofu-announces-general-availability">OpenTofu Announces General Availability</a></li>
<li><a href="https://opentofu.org/faq#opentofu-compatibility">FAQ | OpenTofu</a></li>
<li><a href="https://opentofu.org/docs/intro/install/deb">Installing OpenTofu on .deb-based Linux (Debian, Ubuntu, etc.) | OpenTofu</a></li>
</ul>


