---
title: "Go で map 内のデータを検索するサンプル"
date: 2023-08-26
slug: "Go で map 内のデータを検索するサンプル"
category: blog
tags: [Go]
---
<h2 id="はじめに">はじめに</h2>

<p>Go で map 内のデータを検索するサンプル</p>

<h2 id="サンプル">サンプル</h2>

<pre class="code lang-go" data-lang="go" data-unlink><span class="synStatement">package</span> main

<span class="synStatement">import</span> <span class="synConstant">&quot;errors&quot;</span>

<span class="synStatement">func</span> MapSearch(nums, length []<span class="synType">int</span>) ([]<span class="synType">int</span>, <span class="synType">error</span>) {
    targetMap := <span class="synStatement">make</span>(<span class="synType">map</span>[<span class="synType">int</span>]<span class="synType">int</span>, <span class="synStatement">len</span>(nums))
    <span class="synStatement">for</span> i, nums := <span class="synStatement">range</span> nums {
        targetMap[nums] = i
    }

    target := <span class="synStatement">make</span>([]<span class="synType">int</span>, <span class="synStatement">len</span>(length))
    <span class="synStatement">for</span> si, s := <span class="synStatement">range</span> length {
        <span class="synStatement">if</span> ti, ok := targetMap[s]; ok {
            target[si] = ti
        } <span class="synStatement">else</span> {
            <span class="synStatement">return</span> <span class="synStatement">nil</span>, errors.New(<span class="synConstant">&quot;not found&quot;</span>)
        }
    }
    <span class="synStatement">return</span> target, <span class="synStatement">nil</span>
}

<span class="synStatement">func</span> main() {
    nums := []<span class="synType">int</span>{<span class="synConstant">1</span>, <span class="synConstant">2</span>, <span class="synConstant">3</span>, <span class="synConstant">4</span>, <span class="synConstant">5</span>}
    length := []<span class="synType">int</span>{<span class="synConstant">1</span>, <span class="synConstant">3</span>, <span class="synConstant">5</span>}
    target, err := MapSearch(nums, length)
    <span class="synStatement">if</span> err != <span class="synStatement">nil</span> {
        <span class="synStatement">println</span>(err.Error())
        <span class="synStatement">return</span>
    }
    <span class="synStatement">for</span> _, t := <span class="synStatement">range</span> target {
        <span class="synStatement">println</span>(t)
    }
}
</pre>


<h3 id="テスト">テスト</h3>

<pre class="code lang-go" data-lang="go" data-unlink><span class="synStatement">package</span> main

<span class="synStatement">import</span> (
    <span class="synConstant">&quot;reflect&quot;</span>
    <span class="synConstant">&quot;testing&quot;</span>
)

<span class="synStatement">func</span> Test_MapSearch(t *testing.T) {
    tests := []<span class="synStatement">struct</span> {
        name     <span class="synType">string</span>
        nums     []<span class="synType">int</span>
        target   []<span class="synType">int</span>
        expected []<span class="synType">int</span>
    }{
        {<span class="synConstant">&quot;MapSearch&quot;</span>, []<span class="synType">int</span>{<span class="synConstant">1</span>, <span class="synConstant">2</span>, <span class="synConstant">3</span>, <span class="synConstant">4</span>, <span class="synConstant">5</span>}, []<span class="synType">int</span>{<span class="synConstant">1</span>, <span class="synConstant">3</span>, <span class="synConstant">5</span>}, []<span class="synType">int</span>{<span class="synConstant">0</span>, <span class="synConstant">2</span>, <span class="synConstant">4</span>}},
    }

    fv := reflect.ValueOf(MapSearch)
    name := runtime.FuncForPC(fv.Pointer()).Name()

    <span class="synStatement">for</span> _, tt := <span class="synStatement">range</span> tests {
        t.Run(tt.name, <span class="synType">func</span>(t *testing.T) {
            got, err := MapSearch(tt.nums, tt.target)
            <span class="synStatement">if</span> err != <span class="synStatement">nil</span> {
                t.Errorf(<span class="synConstant">&quot;Error: %v&quot;</span>, err)
            }

            <span class="synStatement">if</span> !reflect.DeepEqual(got, tt.expected) {
                t.Errorf(name+<span class="synConstant">&quot;() = %v, want %v&quot;</span>, got, tt.expected)
            }
        })
    }
}
</pre>


<h3 id="ベンチマークコード"><a class="keyword" href="https://d.hatena.ne.jp/keyword/%A5%D9%A5%F3%A5%C1%A5%DE%A1%BC%A5%AF">ベンチマーク</a>コード</h3>

<pre class="code lang-go" data-lang="go" data-unlink><span class="synStatement">package</span> main

<span class="synStatement">import</span> (
    <span class="synConstant">&quot;testing&quot;</span>
)

<span class="synStatement">func</span> makeSeqNums(count <span class="synType">int</span>) []<span class="synType">int</span> {
    nums := <span class="synStatement">make</span>([]<span class="synType">int</span>, count)
    <span class="synStatement">for</span> i := <span class="synConstant">0</span>; i &lt; count; i++ {
        nums[i] = i + <span class="synConstant">1</span>
    }
    <span class="synStatement">return</span> nums
}

<span class="synStatement">func</span> BenchmarkMapSearch(b *testing.B) {
    nums := makeSeqNums(<span class="synConstant">10000</span>)
    target := makeSeqNums(<span class="synConstant">50000</span>)

    b.ResetTimer()

    <span class="synStatement">for</span> i := <span class="synConstant">0</span>; i &lt; b.N; i++ {
        MapSearch(nums, target)
    }
}
</pre>




<pre class="code" data-lang="" data-unlink>% go test -bench . -benchmem
goos: linux
goarch: amd64
pkg: go-map-search
cpu: Intel(R) Xeon(R) CPU E5-2686 v4 @ 2.30GHz
BenchmarkMapSearch-2        1310        875660 ns/op      723626 B/op         13 allocs/op
PASS
ok      go-map-search   1.252s</pre>


